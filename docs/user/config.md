# é…ç½®æ‰‹å†Œ

> **Audience**: ç”¨æˆ· | **Last reviewed**: 2025-11-21

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Relay Pulse çš„é…ç½®é€‰é¡¹ã€ç¯å¢ƒå˜é‡å’Œæœ€ä½³å®è·µã€‚

## é…ç½®æ–‡ä»¶ç»“æ„

Relay Pulse ä½¿ç”¨ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤è·¯å¾„ä¸º `config.yaml`ã€‚

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# å…¨å±€é…ç½®
interval: "1m"           # å·¡æ£€é—´éš”ï¼ˆæ”¯æŒ Go duration æ ¼å¼ï¼‰
slow_latency: "5s"       # æ…¢è¯·æ±‚é˜ˆå€¼
timeout: "10s"           # è¯·æ±‚è¶…æ—¶æ—¶é—´

# æŒ‰æœåŠ¡ç±»å‹è¦†ç›–ï¼ˆå¯é€‰ï¼‰
slow_latency_by_service:
  cc: "15s"              # Claude Code æœåŠ¡å…è®¸æ›´é•¿å»¶è¿Ÿ
  gm: "3s"               # Gemini æœåŠ¡è¦æ±‚æ›´å¿«
timeout_by_service:
  cc: "30s"              # Claude Code æœåŠ¡å…è®¸æ›´é•¿è¶…æ—¶
  gm: "10s"              # Gemini æœåŠ¡è¶…æ—¶è¾ƒçŸ­

# èµåŠ©å•†ç½®é¡¶é…ç½®
sponsor_pin:
  enabled: true          # æ˜¯å¦å¯ç”¨ç½®é¡¶åŠŸèƒ½
  max_pinned: 3          # æœ€å¤šç½®é¡¶æ•°é‡
  min_uptime: 95.0       # æœ€ä½å¯ç”¨ç‡è¦æ±‚
  min_level: "basic"     # æœ€ä½èµåŠ©çº§åˆ«

# çƒ­æ¿/å†·æ¿é…ç½®
boards:
  enabled: false         # æ˜¯å¦å¯ç”¨çƒ­æ¿/å†·æ¿åŠŸèƒ½

# å­˜å‚¨é…ç½®
storage:
  type: "sqlite"         # å­˜å‚¨ç±»å‹: sqlite æˆ– postgres
  sqlite:
    path: "monitor.db"   # SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
  # PostgreSQL é…ç½®ï¼ˆå¯é€‰ï¼‰
  postgres:
    host: "localhost"
    port: 5432
    user: "monitor"
    password: "password"  # å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡
    database: "llm_monitor"
    sslmode: "disable"    # ç”Ÿäº§ç¯å¢ƒå»ºè®® "require"
    max_open_conns: 25
    max_idle_conns: 5
    conn_max_lifetime: "1h"

# ç›‘æµ‹é¡¹åˆ—è¡¨
monitors:
  - provider: "88code"         # æœåŠ¡å•†æ ‡è¯†ï¼ˆå¿…å¡«ï¼‰
    service: "cc"              # æœåŠ¡ç±»å‹ï¼ˆå¿…å¡«ï¼‰
    category: "commercial"     # åˆ†ç±»ï¼ˆå¿…å¡«ï¼‰: commercial æˆ– public
    sponsor: "å›¢é˜Ÿè‡ªæœ‰"         # èµåŠ©è€…ï¼ˆå¿…å¡«ï¼‰
    sponsor_level: "advanced"  # èµåŠ©ç­‰çº§ï¼ˆå¯é€‰ï¼‰: basic/advanced/enterprise
    channel: "vip"             # ä¸šåŠ¡é€šé“ï¼ˆå¯é€‰ï¼‰
    board: "hot"               # æ¿å—ï¼ˆå¯é€‰ï¼‰: hotï¼ˆé»˜è®¤ï¼‰æˆ– cold
    price_min: 0.05            # å‚è€ƒå€ç‡ä¸‹é™ï¼ˆå¯é€‰ï¼‰
    price_max: 0.2             # å‚è€ƒå€ç‡ï¼ˆå¯é€‰ï¼‰: æ˜¾ç¤ºä¸º "0.125 / 0.05~0.2"
    listed_since: "2024-06-15" # æ”¶å½•æ—¥æœŸï¼ˆå¯é€‰ï¼‰: ç”¨äºè®¡ç®—æ”¶å½•å¤©æ•°
    url: "https://api.88code.com/v1/chat/completions"  # å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¿…å¡«ï¼‰
    method: "POST"             # HTTP æ–¹æ³•ï¼ˆå¿…å¡«ï¼‰
    api_key: "sk-xxx"          # API å¯†é’¥ï¼ˆå¯é€‰ï¼Œå»ºè®®ç”¨ç¯å¢ƒå˜é‡ï¼‰
    headers:                   # è¯·æ±‚å¤´ï¼ˆå¯é€‰ï¼‰
      Authorization: "Bearer {{API_KEY}}"
      Content-Type: "application/json"
    body: |                    # è¯·æ±‚ä½“ï¼ˆå¯é€‰ï¼‰
      {
        "model": "claude-3-opus",
        "messages": [{"role": "user", "content": "hi"}],
        "max_tokens": 1
      }
    success_contains: "content"  # å“åº”ä½“å¿…é¡»åŒ…å«çš„å…³é”®å­—ï¼ˆå¯é€‰ï¼‰
```

## é…ç½®é¡¹è¯¦è§£

### å…¨å±€é…ç½®

#### `interval`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"1m"`
- **è¯´æ˜**: å¥åº·æ£€æŸ¥çš„é—´éš”æ—¶é—´
- **ç¤ºä¾‹**: `"30s"`, `"1m"`, `"5m"`, `"1h"`

#### `slow_latency`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"5s"`
- **è¯´æ˜**: è¶…è¿‡æ­¤é˜ˆå€¼çš„è¯·æ±‚è¢«æ ‡è®°ä¸º"æ…¢è¯·æ±‚"ï¼ˆé»„è‰²çŠ¶æ€ï¼‰
- **ç¤ºä¾‹**: `"3s"`, `"5s"`, `"10s"`

#### `slow_latency_by_service`
- **ç±»å‹**: map[string]string (æœåŠ¡ç±»å‹ â†’ Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: æ— ï¼ˆä½¿ç”¨å…¨å±€ `slow_latency`ï¼‰
- **è¯´æ˜**: æŒ‰æœåŠ¡ç±»å‹è¦†ç›–æ…¢è¯·æ±‚é˜ˆå€¼ï¼Œkey ä¸åŒºåˆ†å¤§å°å†™
- **ç¤ºä¾‹**:
  ```yaml
  slow_latency_by_service:
    cc: "15s"    # Claude Code å¯¹é€Ÿåº¦è¦æ±‚è¾ƒä½
    cx: "10s"    # Codex
    gm: "3s"     # æ¨¡å‹ API è¦æ±‚æ›´å¿«
  ```

#### `timeout`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"10s"`
- **è¯´æ˜**: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡æ­¤æ—¶é—´æœªå“åº”åˆ™è§†ä¸ºå¤±è´¥ï¼ˆçº¢è‰²çŠ¶æ€ï¼‰
- **ç¤ºä¾‹**: `"10s"`, `"30s"`, `"1m"`

#### `timeout_by_service`
- **ç±»å‹**: map[string]string (æœåŠ¡ç±»å‹ â†’ Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: æ— ï¼ˆä½¿ç”¨å…¨å±€ `timeout`ï¼‰
- **è¯´æ˜**: æŒ‰æœåŠ¡ç±»å‹è¦†ç›–è¶…æ—¶æ—¶é—´ï¼Œkey ä¸åŒºåˆ†å¤§å°å†™
- **ç¤ºä¾‹**:
  ```yaml
  timeout_by_service:
    cc: "30s"    # Claude Code å…è®¸æ›´é•¿è¶…æ—¶
    cx: "45s"    # Codex
    gm: "10s"    # æ¨¡å‹ API è¶…æ—¶è¾ƒçŸ­
  ```

#### `degraded_weight`
- **ç±»å‹**: float
- **é»˜è®¤å€¼**: `0.7`
- **è¯´æ˜**: é»„è‰²çŠ¶æ€åœ¨å¯ç”¨ç‡ç»Ÿè®¡ä¸­çš„æƒé‡ï¼Œåˆæ³•èŒƒå›´ 0-1ï¼›å¡« 0 è§†ä¸ºæœªé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ 0.7
- **è®¡ç®—å…¬å¼**: `å¯ç”¨ç‡ = (ç»¿è‰²æ¬¡æ•° Ã— 1.0 + é»„è‰²æ¬¡æ•° Ã— degraded_weight) / æ€»æ¬¡æ•° Ã— 100`

### èµåŠ©å•†ç½®é¡¶é…ç½®

ç”¨äºåœ¨é¡µé¢åˆå§‹åŠ è½½æ—¶ç½®é¡¶ç¬¦åˆæ¡ä»¶çš„èµåŠ©å•†ç›‘æµ‹é¡¹ï¼Œç”¨æˆ·ç‚¹å‡»ä»»æ„æ’åºæŒ‰é’®åç½®é¡¶å¤±æ•ˆï¼Œåˆ·æ–°é¡µé¢æ¢å¤ã€‚

```yaml
sponsor_pin:
  enabled: true           # æ˜¯å¦å¯ç”¨ç½®é¡¶åŠŸèƒ½ï¼ˆé»˜è®¤ trueï¼‰
  max_pinned: 3           # æœ€å¤šç½®é¡¶æ•°é‡ï¼ˆé»˜è®¤ 3ï¼‰
  service_count: 3        # æœåŠ¡æ•°é‡ï¼ˆç”¨äºæŒ‰æœåŠ¡å•†è®¡ç®—ç½®é¡¶é…é¢ï¼›é»˜è®¤ 3ï¼‰
  min_uptime: 95.0        # æœ€ä½å¯ç”¨ç‡è¦æ±‚ï¼ˆé»˜è®¤ 95%ï¼‰
  min_level: "basic"      # æœ€ä½èµåŠ©çº§åˆ«ï¼ˆé»˜è®¤ basicï¼‰
```

#### `sponsor_pin.enabled`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨èµåŠ©å•†ç½®é¡¶åŠŸèƒ½

#### `sponsor_pin.max_pinned`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `3`
- **è¯´æ˜**: æœ€å¤šç½®é¡¶çš„èµåŠ©å•†æ•°é‡ï¼ˆå…¨å±€ç¡¬ä¸Šé™ï¼‰

#### `sponsor_pin.service_count`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `3`
- **çº¦æŸ**: å¿…é¡» â‰¥ 1
- **è¯´æ˜**: å›ºå®šé…ç½®çš„"æ”¯æŒçš„æœåŠ¡æ•°é‡"ï¼Œç”¨äºæŒ‰æœåŠ¡å•†è®¡ç®—ç½®é¡¶é…é¢
- **é…é¢è§„åˆ™**:
  - `enterprise`ï¼ˆé¡¶çº§ï¼‰ï¼šæœ€å¤š `service_count` ä¸ªé€šé“
  - `advanced`ï¼ˆé«˜çº§ï¼‰ï¼šæœ€å¤š `max(1, service_count - 1)` ä¸ªé€šé“
  - `basic`ï¼ˆåŸºç¡€ï¼‰ï¼šæœ€å¤š `1` ä¸ªé€šé“

#### `sponsor_pin.min_uptime`
- **ç±»å‹**: float
- **é»˜è®¤å€¼**: `95.0`
- **è¯´æ˜**: ç½®é¡¶çš„æœ€ä½å¯ç”¨ç‡è¦æ±‚ï¼ˆç™¾åˆ†æ¯”ï¼‰ï¼Œä½äºæ­¤å€¼çš„èµåŠ©å•†ä¸ä¼šè¢«ç½®é¡¶

#### `sponsor_pin.min_level`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `"basic"`
- **å¯é€‰å€¼**: `"basic"`, `"advanced"`, `"enterprise"`
- **è¯´æ˜**: ç½®é¡¶çš„æœ€ä½èµåŠ©çº§åˆ«ï¼Œçº§åˆ«ä½äºæ­¤å€¼çš„èµåŠ©å•†ä¸ä¼šè¢«ç½®é¡¶
- **çº§åˆ«æƒé‡**: `enterprise` > `advanced` > `basic`

#### ç½®é¡¶è§„åˆ™

1. **ç½®é¡¶æ¡ä»¶**: ç›‘æµ‹é¡¹å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰ä¼šè¢«ç½®é¡¶ï¼š
   - æœ‰ `sponsor_level` é…ç½®
   - æ— é£é™©æ ‡è®°ï¼ˆ`risks` æ•°ç»„ä¸ºç©ºæˆ–æœªé…ç½®ï¼‰
   - å¯ç”¨ç‡ â‰¥ `min_uptime`
   - èµåŠ©çº§åˆ« â‰¥ `min_level`

2. **é…é¢ä¸æ’åºè§„åˆ™**:
   - ç½®é¡¶é…é¢æŒ‰æœåŠ¡å•†ï¼ˆ`provider`ï¼‰è®¡ç®—ï¼š
     - `enterprise`ï¼ˆé¡¶çº§ï¼‰ï¼šæœ€å¤š `service_count` ä¸ªé€šé“
     - `advanced`ï¼ˆé«˜çº§ï¼‰ï¼šæœ€å¤š `max(1, service_count - 1)` ä¸ªé€šé“
     - `basic`ï¼ˆåŸºç¡€ï¼‰ï¼šæœ€å¤š `1` ä¸ªé€šé“
   - ç½®é¡¶é¡¹æŒ‰èµåŠ©çº§åˆ«æ’åºï¼ˆ`enterprise` > `advanced` > `basic`ï¼‰
   - åŒçº§åˆ«æŒ‰å¯ç”¨ç‡é™åºæ’åº
   - åŒå¯ç”¨ç‡æŒ‰å“åº”å»¶è¿Ÿå‡åºæ’åºï¼ˆä½å»¶è¿Ÿä¼˜å…ˆï¼‰
   - åŒä¸€æœåŠ¡å•†åŒä¸€æœåŠ¡ç±»å‹æœ€å¤šç½®é¡¶ 1 ä¸ªï¼ˆ`provider + service` å»é‡ï¼‰
   - æœ€ç»ˆç½®é¡¶æ•°é‡ä»å— `max_pinned` å…¨å±€æˆªæ–­é™åˆ¶
   - å…¶ä½™é¡¹æŒ‰å¯ç”¨ç‡é™åºæ’åº

3. **è§†è§‰æ•ˆæœ**: ç½®é¡¶é¡¹æ˜¾ç¤ºå¯¹åº”å¾½æ ‡é¢œè‰²çš„æ·¡è‰²èƒŒæ™¯ï¼ˆ5% é€æ˜åº¦ï¼‰

4. **äº¤äº’è¡Œä¸º**:
   - ç”¨æˆ·ç‚¹å‡»ä»»æ„æ’åºæŒ‰é’®åï¼Œç½®é¡¶æ•ˆæœå¤±æ•ˆ
   - åˆ·æ–°é¡µé¢åï¼Œç½®é¡¶æ•ˆæœæ¢å¤

### çƒ­æ¿/å†·æ¿é…ç½®

ç”¨äºå°†ç›‘æµ‹é¡¹åˆ†ä¸º"çƒ­æ¿"ï¼ˆæ­£å¸¸ç›‘æµ‹ï¼‰å’Œ"å†·æ¿"ï¼ˆæš‚åœç›‘æµ‹ï¼Œä»…å±•ç¤ºå†å²æ•°æ®ï¼‰ä¸¤ç±»ï¼Œé€‚ç”¨äºï¼š
- æœåŠ¡å•†è´¨é‡é•¿æœŸæ³¢åŠ¨ï¼Œç§»å…¥å†·æ¿ä¿ç•™å†å²ä¾›å¯¹æ¯”
- æ¸ é“/èŠ‚ç‚¹ä¸‹çº¿ï¼Œåœæ­¢ç›‘æµ‹é¿å…è¯¯æŠ¥ï¼Œä¿ç•™å®¡è®¡æ•°æ®
- ç›‘æµ‹é¡¹è§„æ¨¡å¢é•¿ï¼Œä½ä»·å€¼é¡¹å…¥å†·æ¿é™ä½ API è°ƒç”¨é‡

```yaml
# å…¨å±€é…ç½®
boards:
  enabled: true           # æ˜¯å¦å¯ç”¨çƒ­æ¿/å†·æ¿åŠŸèƒ½ï¼ˆé»˜è®¤ falseï¼‰

# ç›‘æµ‹é¡¹é…ç½®
monitors:
  - provider: "88code"
    service: "cc"
    board: "cold"              # æ¿å—ç±»å‹ï¼šhotï¼ˆé»˜è®¤ï¼‰æˆ– cold
    cold_reason: "è¯¥æ¸ é“é•¿æœŸä¸ç¨³å®šï¼Œå…ˆå½’æ¡£èŠ‚çœæ¢æµ‹èµ„æº"  # å½’æ¡£åŸå› ï¼ˆå¯é€‰ï¼‰
    # ... å…¶ä»–é…ç½®
```

#### `boards.enabled`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨çƒ­æ¿/å†·æ¿åŠŸèƒ½ï¼›ç¦ç”¨æ—¶æ‰€æœ‰ç›‘æµ‹é¡¹å‡è§†ä¸ºçƒ­æ¿

#### ç›‘æµ‹é¡¹ `board`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `"hot"`
- **å¯é€‰å€¼**: `"hot"`, `"cold"`
- **è¯´æ˜**: ç›‘æµ‹é¡¹æ‰€å±æ¿å—
  - `hot`: çƒ­æ¿ï¼Œæ­£å¸¸ç›‘æµ‹ï¼Œå®æ—¶æ›´æ–°æ•°æ®
  - `cold`: å†·æ¿ï¼Œåœæ­¢ç›‘æµ‹ï¼Œä»…å±•ç¤ºå†å²æ•°æ®

#### ç›‘æµ‹é¡¹ `cold_reason`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `""`ï¼ˆç©ºï¼‰
- **è¯´æ˜**: ç§»å…¥å†·æ¿çš„åŸå› è¯´æ˜ï¼ˆä»…ç”¨äº `board: cold` çš„ç›‘æµ‹é¡¹ï¼‰
- **çº¦æŸ**: ä»…å½“ `board: cold` æ—¶æœ‰æ•ˆï¼›å¦‚æœåœ¨çƒ­æ¿é¡¹ä¸­é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè¾“å‡ºè­¦å‘Šå¹¶è‡ªåŠ¨æ¸…ç©º

#### ä¸ç°æœ‰æœºåˆ¶çš„å…³ç³»

| çŠ¶æ€ | æ¢æµ‹ | å­˜å‚¨ | å±•ç¤º | ç”¨é€” |
|------|-----|-----|-----|------|
| `disabled: true` | âŒ | âŒ | âŒ | å½»åº•ç¦ç”¨ |
| `hidden: true` | âœ… | âœ… | âŒ | ä¸´æ—¶éšè—ä½†ç»§ç»­ç›‘æµ‹ |
| `board: cold` | âŒ | âŒ | âœ… | **å±•ç¤ºå†å²ä½†ä¸æ¢æµ‹** |

#### å‰ç«¯äº¤äº’

- å½“ `boards.enabled: true` æ—¶ï¼Œæ§åˆ¶æ æ˜¾ç¤ºçƒ­æ¿/å†·æ¿åˆ‡æ¢æŒ‰é’®ï¼ˆç«ç„°/é›ªèŠ±å›¾æ ‡ï¼‰
- åˆ‡æ¢åˆ°å†·æ¿æ—¶ï¼Œé¡µé¢é¡¶éƒ¨æ˜¾ç¤ºæç¤ºï¼š"å†·æ¿ç›‘æµ‹é¡¹å·²æš‚åœæ¢æµ‹ï¼Œä»…å±•ç¤ºå†å²æ•°æ®"
- URL æ”¯æŒ `?board=cold` å‚æ•°ç”¨äºåˆ†äº«å†·æ¿é“¾æ¥

#### `max_concurrency`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `10`
- **è¯´æ˜**: å•è½®å·¡æ£€å…è®¸çš„æœ€å¤§å¹¶å‘æ¢æµ‹æ•°
- **ç‰¹æ®Šå€¼**:
  - `0` æˆ–æœªé…ç½®: ä½¿ç”¨é»˜è®¤å€¼ 10
  - `-1`: æ— é™åˆ¶ï¼Œè‡ªåŠ¨æ‰©å®¹åˆ°ç›‘æµ‹é¡¹æ•°é‡
  - `>0`: ç¡¬ä¸Šé™ï¼Œè¶…è¿‡æ—¶æ’é˜Ÿç­‰å¾…
- **è°ƒä¼˜å»ºè®®**:
  - å°è§„æ¨¡ (<20 é¡¹): 10-20
  - ä¸­ç­‰è§„æ¨¡ (20-100 é¡¹): 50-100
  - å¤§è§„æ¨¡ (>100 é¡¹): `-1` æˆ–æ›´é«˜å€¼

#### `stagger_probes`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦åœ¨å•ä¸ªå‘¨æœŸå†…å¯¹æ¢æµ‹è¿›è¡Œé”™å³°åˆ†å¸ƒï¼Œé¿å…æµé‡çªå‘
- **è¡Œä¸º**:
  - `true`: å°†ç›‘æµ‹é¡¹å‡åŒ€åˆ†æ•£åœ¨æ•´ä¸ªå·¡æ£€å‘¨æœŸå†…æ‰§è¡Œï¼ˆæ¨èï¼‰
  - `false`: æ‰€æœ‰ç›‘æµ‹é¡¹åŒæ—¶æ‰§è¡Œï¼ˆä»…ç”¨äºè°ƒè¯•æˆ–å‹æµ‹ï¼‰

### äº‹ä»¶é€šçŸ¥é…ç½®

ç”¨äºè®¢é˜…æœåŠ¡çŠ¶æ€å˜æ›´äº‹ä»¶ï¼Œæ”¯æŒå¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ Cloudflare Workerï¼‰è½®è¯¢è·å–äº‹ä»¶å¹¶è§¦å‘é€šçŸ¥ï¼ˆå¦‚ Telegram æ¶ˆæ¯ï¼‰ã€‚

```yaml
events:
  enabled: true           # æ˜¯å¦å¯ç”¨äº‹ä»¶åŠŸèƒ½ï¼ˆé»˜è®¤ falseï¼‰
  mode: "model"           # äº‹ä»¶æ£€æµ‹ç²’åº¦ï¼š"model"ï¼ˆé»˜è®¤ï¼‰æˆ– "channel"
  down_threshold: 2       # è¿ç»­ N æ¬¡ä¸å¯ç”¨è§¦å‘ DOWN äº‹ä»¶ï¼ˆé»˜è®¤ 2ï¼‰
  up_threshold: 1         # è¿ç»­ N æ¬¡å¯ç”¨è§¦å‘ UP äº‹ä»¶ï¼ˆé»˜è®¤ 1ï¼‰
  channel_down_threshold: 1    # é€šé“çº§ DOWN é˜ˆå€¼ï¼ˆmode=channel æ—¶ç”Ÿæ•ˆï¼‰
  channel_count_mode: "recompute"  # é€šé“çº§è®¡æ•°æ¨¡å¼ï¼ˆmode=channel æ—¶ç”Ÿæ•ˆï¼‰
  api_token: ""           # API è®¿é—®ä»¤ç‰Œï¼ˆç©º=æ— é‰´æƒï¼‰
```

#### `events.enabled`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨äº‹ä»¶æ£€æµ‹å’Œ API ç«¯ç‚¹

#### `events.down_threshold`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `2`
- **è¯´æ˜**: è¿ç»­å¤šå°‘æ¬¡ä¸å¯ç”¨ï¼ˆçº¢è‰²çŠ¶æ€ï¼‰æ‰è§¦å‘ DOWN äº‹ä»¶
- **è®¾è®¡æ„å›¾**: é¿å…å¶å‘æ•…éšœäº§ç”Ÿè¯¯æŠ¥

#### `events.up_threshold`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `1`
- **è¯´æ˜**: è¿ç»­å¤šå°‘æ¬¡å¯ç”¨ï¼ˆç»¿è‰²æˆ–é»„è‰²çŠ¶æ€ï¼‰æ‰è§¦å‘ UP äº‹ä»¶
- **è®¾è®¡æ„å›¾**: æœåŠ¡æ¢å¤åå°½å¿«é€šçŸ¥

#### `events.api_token`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `""`ï¼ˆç©ºï¼Œæ— é‰´æƒï¼‰
- **è¯´æ˜**: äº‹ä»¶ API çš„è®¿é—®ä»¤ç‰Œï¼Œç”¨äºä¿æŠ¤ `/api/events` ç«¯ç‚¹
- **ä½¿ç”¨æ–¹å¼**: è¯·æ±‚æ—¶éœ€åœ¨ Header ä¸­æºå¸¦ `Authorization: Bearer <token>`

#### `events.mode`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `"model"`
- **å¯é€‰å€¼**: `"model"`, `"channel"`
- **è¯´æ˜**: äº‹ä»¶æ£€æµ‹ç²’åº¦æ¨¡å¼
  - `model`: æ¨¡å‹çº§äº‹ä»¶æ£€æµ‹ï¼ˆé»˜è®¤ï¼‰ï¼Œæ¯ä¸ªæ¨¡å‹ç‹¬ç«‹è§¦å‘ DOWN/UP äº‹ä»¶
  - `channel`: é€šé“çº§äº‹ä»¶æ£€æµ‹ï¼ŒåŸºäºé€šé“å†…æ¨¡å‹çš„æ•´ä½“çŠ¶æ€è§¦å‘äº‹ä»¶
- **ä½¿ç”¨åœºæ™¯**:
  - `model`: éœ€è¦ç²¾ç»†ç›‘æ§æ¯ä¸ªæ¨¡å‹çŠ¶æ€å˜åŒ–çš„åœºæ™¯
  - `channel`: åªå…³å¿ƒé€šé“æ•´ä½“å¯ç”¨æ€§ï¼Œå‡å°‘äº‹ä»¶å™ªéŸ³

#### `events.channel_down_threshold`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `1`
- **è¯´æ˜**: é€šé“çº§ DOWN äº‹ä»¶çš„è§¦å‘é˜ˆå€¼ï¼ˆä»… `mode: channel` æ—¶ç”Ÿæ•ˆï¼‰
- **è¡Œä¸º**: å½“é€šé“å†… DOWN çŠ¶æ€çš„æ¨¡å‹æ•°é‡ â‰¥ æ­¤é˜ˆå€¼æ—¶ï¼Œè§¦å‘é€šé“çº§ DOWN äº‹ä»¶
- **ç¤ºä¾‹**: è®¾ä¸º `2` è¡¨ç¤ºè‡³å°‘ 2 ä¸ªæ¨¡å‹ DOWN æ‰è§¦å‘é€šé“ DOWN

#### `events.channel_count_mode`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `"recompute"`
- **å¯é€‰å€¼**: `"recompute"`, `"incremental"`
- **è¯´æ˜**: é€šé“çº§è®¡æ•°æ¨¡å¼ï¼ˆä»… `mode: channel` æ—¶ç”Ÿæ•ˆï¼‰
  - `recompute`ï¼ˆé»˜è®¤ï¼‰: æ¯æ¬¡åŸºäºæ´»è·ƒæ¨¡å‹é›†åˆé‡æ–°è®¡ç®— `down_count`/`known_count`
    - âœ… è§£å†³è¿ç§»åœºæ™¯ï¼ˆä» `mode: model` åˆ‡æ¢åˆ° `mode: channel`ï¼‰
    - âœ… è§£å†³æ¨¡å‹åˆ é™¤å¯¼è‡´çš„çŠ¶æ€å¡æ­»é—®é¢˜
    - âœ… è‡ªåŠ¨ä¿®å¤è®¡æ•°å¼‚å¸¸
    - âš ï¸ æ¯æ¬¡æ¢æµ‹éœ€æŸ¥è¯¢æ‰€æœ‰æ¨¡å‹çŠ¶æ€ï¼ˆO(n) å¤æ‚åº¦ï¼‰
  - `incremental`: å¢é‡ç»´æŠ¤ `down_count`/`count`
    - âœ… æ€§èƒ½æœ€ä¼˜ï¼ˆO(1) å¤æ‚åº¦ï¼‰
    - âš ï¸ è¿ç§»åœºæ™¯å¯èƒ½æœ‰é—®é¢˜ï¼ˆé¦–æ¬¡å¯ç”¨æ—¶ `channel_states` ä¸ºç©ºï¼‰
    - âš ï¸ æ¨¡å‹åˆ é™¤åè®¡æ•°ä¸ä¼šè‡ªåŠ¨å›æ”¶
    - ğŸ”§ å†…ç½®è‡ªæ„ˆæœºåˆ¶ï¼šæ£€æµ‹åˆ°è®¡æ•°å¼‚å¸¸æ—¶è‡ªåŠ¨å›é€€åˆ° `recompute` æ ¡å‡†
- **æ¨è**:
  - æ–°éƒ¨ç½²æˆ–é…ç½®é¢‘ç¹å˜æ›´ï¼šä½¿ç”¨ `recompute`ï¼ˆé»˜è®¤ï¼‰
  - å¤§è§„æ¨¡ç¨³å®šè¿è¡Œçš„ç³»ç»Ÿï¼šå¯åˆ‡æ¢åˆ° `incremental` ä¼˜åŒ–æ€§èƒ½

**é€šé“çº§äº‹ä»¶é…ç½®ç¤ºä¾‹**:

```yaml
events:
  enabled: true
  mode: "channel"              # å¯ç”¨é€šé“çº§äº‹ä»¶æ£€æµ‹
  down_threshold: 2            # æ¨¡å‹çº§é˜ˆå€¼ï¼ˆä»ç”¨äºæ¨¡å‹çŠ¶æ€æœºï¼‰
  up_threshold: 1              # æ¨¡å‹çº§é˜ˆå€¼
  channel_down_threshold: 1    # é€šé“çº§é˜ˆå€¼ï¼š1 ä¸ªæ¨¡å‹ DOWN å³è§¦å‘é€šé“ DOWN
  channel_count_mode: "recompute"  # æ¨èï¼šæ¯æ¬¡é‡ç®—ï¼Œæ›´ç¨³å®š
  api_token: "your-secure-token"
```

**é€šé“çº§äº‹ä»¶ Meta å­—æ®µ**:

é€šé“çº§äº‹ä»¶ï¼ˆ`model` å­—æ®µä¸ºç©ºï¼‰çš„ `meta` åŒ…å«ä»¥ä¸‹é¢å¤–ä¿¡æ¯ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `scope` | string | å›ºå®šä¸º `"channel"`ï¼Œæ ‡è¯†é€šé“çº§äº‹ä»¶ |
| `trigger_model` | string | è§¦å‘æ­¤äº‹ä»¶çš„æ¨¡å‹åç§° |
| `down_count` | int | å½“å‰ DOWN çŠ¶æ€çš„æ¨¡å‹æ•°é‡ |
| `known_count` | int | å·²çŸ¥çŠ¶æ€çš„æ¨¡å‹æ•°é‡ |
| `total_models` | int | è¯¥é€šé“çš„æ´»è·ƒæ¨¡å‹æ€»æ•° |
| `channel_down_threshold` | int | é…ç½®çš„é€šé“ DOWN é˜ˆå€¼ |
| `down_models` | []string | DOWN çŠ¶æ€çš„æ¨¡å‹åˆ—è¡¨ |
| `up_models` | []string | UP çŠ¶æ€çš„æ¨¡å‹åˆ—è¡¨ |
| `model_states` | object | å„æ¨¡å‹çš„è¯¦ç»†çŠ¶æ€ |
| `models` | []string | å…¼å®¹å­—æ®µï¼šDOWN äº‹ä»¶ä¸º `down_models`ï¼ŒUP äº‹ä»¶ä¸º `up_models` |

#### äº‹ä»¶ API ç«¯ç‚¹

**è·å–äº‹ä»¶åˆ—è¡¨**:
```bash
# æ— é‰´æƒæ¨¡å¼
curl "http://localhost:8080/api/events?since_id=0&limit=100"

# æœ‰é‰´æƒæ¨¡å¼
curl -H "Authorization: Bearer your-token" \
     "http://localhost:8080/api/events?since_id=0&limit=100"

# å“åº”ç¤ºä¾‹
{
  "events": [{
    "id": 123,
    "provider": "88code",
    "service": "cc",
    "channel": "standard",
    "type": "DOWN",
    "from_status": 1,
    "to_status": 0,
    "trigger_record_id": 45678,
    "observed_at": 1703232000,
    "created_at": 1703232001,
    "meta": { "http_code": 503, "sub_status": "server_error" }
  }],
  "meta": { "next_since_id": 123, "has_more": false, "count": 1 }
}
```

**è·å–æœ€æ–°äº‹ä»¶ ID**ï¼ˆç”¨äºåˆå§‹åŒ–æ¸¸æ ‡ï¼‰:
```bash
curl "http://localhost:8080/api/events/latest"

# å“åº”
{ "latest_id": 123 }
```

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `since_id` | integer | `0` | æ¸¸æ ‡ï¼Œè¿”å› ID å¤§äºæ­¤å€¼çš„äº‹ä»¶ |
| `limit` | integer | `100` | è¿”å›æ•°é‡ä¸Šé™ï¼ˆæœ€å¤§ 500ï¼‰|
| `provider` | string | - | æŒ‰æœåŠ¡å•†è¿‡æ»¤ |
| `service` | string | - | æŒ‰æœåŠ¡ç±»å‹è¿‡æ»¤ |
| `channel` | string | - | æŒ‰é€šé“è¿‡æ»¤ |
| `types` | string | - | æŒ‰äº‹ä»¶ç±»å‹è¿‡æ»¤ï¼Œé€—å·åˆ†éš”ï¼ˆ`DOWN,UP`ï¼‰|

#### äº‹ä»¶ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | è§¦å‘æ¡ä»¶ |
|------|------|----------|
| `DOWN` | æœåŠ¡ä¸å¯ç”¨ | ç¨³å®šæ€ä¸º"å¯ç”¨"ï¼Œè¿ç»­ `down_threshold` æ¬¡çº¢è‰² |
| `UP` | æœåŠ¡æ¢å¤ | ç¨³å®šæ€ä¸º"ä¸å¯ç”¨"ï¼Œè¿ç»­ `up_threshold` æ¬¡å¯ç”¨ï¼ˆç»¿è‰²æˆ–é»„è‰²ï¼‰|

#### çŠ¶æ€æ˜ å°„è§„åˆ™

- **ç»¿è‰²ï¼ˆstatus=1ï¼‰** â†’ å¯ç”¨
- **é»„è‰²ï¼ˆstatus=2ï¼‰** â†’ å¯ç”¨ï¼ˆè§†ä¸ºå¯ç”¨ï¼Œä¸è§¦å‘ DOWNï¼‰
- **çº¢è‰²ï¼ˆstatus=0ï¼‰** â†’ ä¸å¯ç”¨

#### ä½¿ç”¨ç¤ºä¾‹ï¼šCloudflare Worker é›†æˆ

```javascript
// Cloudflare Worker ç¤ºä¾‹ - è½®è¯¢äº‹ä»¶å¹¶å‘é€ Telegram é€šçŸ¥
// ç¯å¢ƒå˜é‡ï¼šRELAY_PULSE_URL, API_TOKEN, TG_BOT_TOKEN, TG_CHAT_ID

export default {
  // å®šæ—¶è§¦å‘ï¼ˆå»ºè®®æ¯åˆ†é’Ÿæ‰§è¡Œï¼‰
  async scheduled(event, env, ctx) {
    // ä» KV è·å–ä¸Šæ¬¡å¤„ç†çš„äº‹ä»¶ ID
    const lastEventId = parseInt(await env.KV.get('LAST_EVENT_ID') || '0');

    // è·å–æ–°äº‹ä»¶
    const response = await fetch(
      `${env.RELAY_PULSE_URL}/api/events?since_id=${lastEventId}&limit=100`,
      {
        headers: {
          'Authorization': `Bearer ${env.API_TOKEN}`,
          'Accept-Encoding': 'gzip'
        }
      }
    );

    if (!response.ok) {
      console.error('è·å–äº‹ä»¶å¤±è´¥:', response.status);
      return;
    }

    const data = await response.json();

    // å¤„ç†æ¯ä¸ªäº‹ä»¶
    for (const event of data.events) {
      await sendTelegramMessage(env, event);
    }

    // æ›´æ–°æ¸¸æ ‡
    if (data.meta.next_since_id > lastEventId) {
      await env.KV.put('LAST_EVENT_ID', data.meta.next_since_id.toString());
    }
  }
};

// å‘é€ Telegram æ¶ˆæ¯
async function sendTelegramMessage(env, event) {
  const emoji = event.type === 'DOWN' ? 'ğŸ”´' : 'ğŸŸ¢';
  const statusText = event.type === 'DOWN' ? 'æœåŠ¡ä¸å¯ç”¨' : 'æœåŠ¡å·²æ¢å¤';

  const text = `${emoji} <b>${statusText}</b>

æœåŠ¡å•†: ${event.provider}
æœåŠ¡: ${event.service}${event.channel ? `\né€šé“: ${event.channel}` : ''}
çŠ¶æ€å˜æ›´: ${event.from_status} â†’ ${event.to_status}
æ£€æµ‹æ—¶é—´: ${new Date(event.observed_at * 1000).toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' })}`;

  await fetch(`https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: env.TG_CHAT_ID,
      text: text,
      parse_mode: 'HTML'
    })
  });
}
```

**Cloudflare Worker é…ç½®**ï¼š

1. åˆ›å»º KV å‘½åç©ºé—´ç”¨äºå­˜å‚¨æ¸¸æ ‡ï¼š
   ```bash
   wrangler kv:namespace create "RELAY_PULSE_KV"
   ```

2. é…ç½® `wrangler.toml`ï¼š
   ```toml
   name = "relay-pulse-notifier"
   main = "src/index.js"

   [triggers]
   crons = ["* * * * *"]  # æ¯åˆ†é’Ÿæ‰§è¡Œ

   [[kv_namespaces]]
   binding = "KV"
   id = "<your-kv-namespace-id>"

   [vars]
   RELAY_PULSE_URL = "https://your-relay-pulse-domain.com"

   # æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ secrets
   # wrangler secret put API_TOKEN
   # wrangler secret put TG_BOT_TOKEN
   # wrangler secret put TG_CHAT_ID
   ```

3. éƒ¨ç½²ï¼š
   ```bash
   wrangler deploy
   ```

#### `public_base_url`
- **ç±»å‹**: string
- **é»˜è®¤å€¼**: `"https://relaypulse.top"`
- **è¯´æ˜**: å¯¹å¤–è®¿é—®çš„åŸºç¡€ URLï¼Œç”¨äºç”Ÿæˆ sitemapã€åˆ†äº«é“¾æ¥ç­‰
- **ç¯å¢ƒå˜é‡**: `MONITOR_PUBLIC_BASE_URL`
- **æ ¼å¼è¦æ±‚**: å¿…é¡»æ˜¯ `http://` æˆ– `https://` åè®®

#### `enable_concurrent_query`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: å¯ç”¨ API å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–ï¼Œæ˜¾è‘—é™ä½ `/api/status` æ¥å£å“åº”æ—¶é—´
- **æ€§èƒ½æå‡**: 10 ä¸ªç›‘æµ‹é¡¹æŸ¥è¯¢æ—¶é—´ä» ~2s é™è‡³ ~300msï¼ˆ-85%ï¼‰
- **é€‚ç”¨åœºæ™¯**:
  - âœ… PostgreSQL å­˜å‚¨ï¼ˆæ¨èï¼‰
  - âŒ SQLite å­˜å‚¨ï¼ˆæ— æ•ˆæœï¼Œä¼šäº§ç”Ÿè­¦å‘Šï¼‰
- **æ³¨æ„äº‹é¡¹**:
  - éœ€è¦ç¡®ä¿æ•°æ®åº“è¿æ¥æ± é…ç½®å……è¶³ï¼ˆå»ºè®® `max_open_conns >= 50`ï¼‰
  - é»˜è®¤å…³é—­ï¼Œå‘åå…¼å®¹ç°æœ‰é…ç½®

**ç¤ºä¾‹é…ç½®ï¼š**
```yaml
# å¯ç”¨å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæ¨è PostgreSQL ç”¨æˆ·å¯ç”¨ï¼‰
enable_concurrent_query: true
```

#### `concurrent_query_limit`
- **ç±»å‹**: integer
- **é»˜è®¤å€¼**: `10`
- **è¯´æ˜**: å¹¶å‘æŸ¥è¯¢æ—¶çš„æœ€å¤§å¹¶å‘åº¦ï¼Œé™åˆ¶åŒæ—¶æ‰§è¡Œçš„æ•°æ®åº“æŸ¥è¯¢æ•°é‡
- **ä»…å½“** `enable_concurrent_query=true` **æ—¶ç”Ÿæ•ˆ**
- **é…ç½®å»ºè®®**:
  ```
  max_open_conns >= concurrent_query_limit Ã— å¹¶å‘è¯·æ±‚æ•° Ã— 1.2
  ```
  - ç¤ºä¾‹ï¼š`50 >= 10 Ã— 3 Ã— 1.2 = 36`ï¼ˆå®‰å…¨ï¼‰
  - å¦‚æœé…ç½®ä¸å½“ï¼Œå¯åŠ¨æ—¶ä¼šçœ‹åˆ°è­¦å‘Šï¼š
    ```
    [Config] è­¦å‘Š: max_open_conns(25) < concurrent_query_limit(10)ï¼Œå¯èƒ½å¯¼è‡´è¿æ¥æ± ç­‰å¾…
    ```

**ç¤ºä¾‹é…ç½®ï¼š**
```yaml
enable_concurrent_query: true
concurrent_query_limit: 10  # æ ¹æ®æ•°æ®åº“è¿æ¥æ± å¤§å°è°ƒæ•´
```

#### `enable_batch_query`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: å¯ç”¨æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–ï¼Œå°† N ä¸ªç›‘æµ‹é¡¹çš„æŸ¥è¯¢ä» 2N æ¬¡å¾€è¿”é™ä¸º 2 æ¬¡
- **é€‚ç”¨åœºæ™¯**:
  - âœ… 7d/30d é•¿å‘¨æœŸæŸ¥è¯¢ï¼ˆæ•°æ®é‡å¤§ï¼Œæ•ˆæœæ˜æ˜¾ï¼‰
  - âŒ 90m/24h çŸ­å‘¨æœŸæŸ¥è¯¢ï¼ˆæ•°æ®é‡å°ï¼Œè‡ªåŠ¨å›é€€åˆ°å¹¶å‘æ¨¡å¼ï¼‰
- **æ€§èƒ½å½±å“**:
  - å‡å°‘æ•°æ®åº“å¾€è¿”æ¬¡æ•°ï¼Œä½†ä¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜
  - å¯¹äºå¤§è§„æ¨¡éƒ¨ç½²ï¼ˆ>50 ç›‘æµ‹é¡¹ï¼‰ï¼Œå»ºè®®é…åˆ `enable_db_timeline_agg` ä½¿ç”¨
- **æ³¨æ„äº‹é¡¹**:
  - å¯ç”¨åï¼Œ7d/30d æŸ¥è¯¢ä¼šè‡ªåŠ¨ä½¿ç”¨æ‰¹é‡æ¨¡å¼
  - å¦‚æœæ‰¹é‡æŸ¥è¯¢å¤±è´¥ï¼Œä¼šè‡ªåŠ¨å›é€€åˆ°å¹¶å‘/ä¸²è¡Œæ¨¡å¼

**ç¤ºä¾‹é…ç½®ï¼š**
```yaml
enable_batch_query: true
```

#### `enable_db_timeline_agg`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: å¯ç”¨ DB ä¾§æ—¶é—´è½´èšåˆä¼˜åŒ–ï¼Œå°† bucket èšåˆä¸‹æ¨åˆ° PostgreSQL
- **ä»…æ”¯æŒ**: PostgreSQLï¼ˆSQLite ä¼šè‡ªåŠ¨å›é€€åˆ°åº”ç”¨å±‚èšåˆï¼‰
- **ä¾èµ–**: éœ€è¦åŒæ—¶å¯ç”¨ `enable_batch_query: true` æ‰èƒ½ç”Ÿæ•ˆ
- **æ€§èƒ½æå‡**:
  - 7d æŸ¥è¯¢ï¼šæ•°æ®ä¼ è¾“ä» ~50 ä¸‡è¡Œé™è‡³ 7 è¡Œï¼ˆper ç›‘æµ‹é¡¹ï¼‰
  - 30d æŸ¥è¯¢ï¼šæ•°æ®ä¼ è¾“ä» ~216 ä¸‡è¡Œé™è‡³ 30 è¡Œï¼ˆper ç›‘æµ‹é¡¹ï¼‰
  - æ˜¾è‘—å‡å°‘ç½‘ç»œä¼ è¾“å’Œåº”ç”¨å±‚å†…å­˜å ç”¨
- **é€‚ç”¨åœºæ™¯**:
  - âœ… PostgreSQL å­˜å‚¨ + å¤§è§„æ¨¡ç›‘æµ‹ï¼ˆ>50 é¡¹ï¼‰
  - âœ… 7d/30d é•¿å‘¨æœŸæŸ¥è¯¢
  - âŒ SQLite å­˜å‚¨ï¼ˆè‡ªåŠ¨å›é€€ï¼‰
  - âŒ 90m/24h çŸ­å‘¨æœŸæŸ¥è¯¢ï¼ˆä¸è§¦å‘ï¼‰

**ç¤ºä¾‹é…ç½®ï¼ˆPostgreSQL é«˜æ€§èƒ½éƒ¨ç½²ï¼‰ï¼š**
```yaml
# å¯ç”¨æ‰€æœ‰æŸ¥è¯¢ä¼˜åŒ–
enable_concurrent_query: true
concurrent_query_limit: 20
enable_batch_query: true
enable_db_timeline_agg: true  # ä»… PostgreSQL ç”Ÿæ•ˆ

# PostgreSQL è¿æ¥æ± 
storage:
  type: "postgres"
  postgres:
    max_open_conns: 100
    max_idle_conns: 20
```

### API å“åº”ç¼“å­˜é…ç½®

ç”¨äºæ§åˆ¶ `/api/status` æ¥å£çš„å“åº”ç¼“å­˜æ—¶é—´ï¼Œä¸åŒçš„æŸ¥è¯¢å‘¨æœŸå¯ä»¥é…ç½®ä¸åŒçš„ TTLã€‚

```yaml
cache_ttl:
  90m: "10s"    # è¿‘ 90 åˆ†é’ŸæŸ¥è¯¢çš„ç¼“å­˜ TTLï¼ˆé»˜è®¤ 10sï¼‰
  24h: "10s"    # è¿‘ 24 å°æ—¶æŸ¥è¯¢çš„ç¼“å­˜ TTLï¼ˆé»˜è®¤ 10sï¼‰
  7d: "60s"     # è¿‘ 7 å¤©æŸ¥è¯¢çš„ç¼“å­˜ TTLï¼ˆé»˜è®¤ 60sï¼‰
  30d: "60s"    # è¿‘ 30 å¤©æŸ¥è¯¢çš„ç¼“å­˜ TTLï¼ˆé»˜è®¤ 60sï¼‰
```

#### `cache_ttl.90m`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"10s"`
- **è¯´æ˜**: è¿‘ 90 åˆ†é’Ÿï¼ˆ`period=90m`ï¼‰æŸ¥è¯¢çš„ç¼“å­˜æœ‰æ•ˆæœŸ

#### `cache_ttl.24h`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"10s"`
- **è¯´æ˜**: è¿‘ 24 å°æ—¶ï¼ˆ`period=24h` æˆ– `period=1d`ï¼‰æŸ¥è¯¢çš„ç¼“å­˜æœ‰æ•ˆæœŸ

#### `cache_ttl.7d`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"60s"`
- **è¯´æ˜**: è¿‘ 7 å¤©ï¼ˆ`period=7d`ï¼‰æŸ¥è¯¢çš„ç¼“å­˜æœ‰æ•ˆæœŸ
- **å»ºè®®**: 7d æ•°æ®é‡è¾ƒå¤§ï¼Œå»ºè®®ä¿æŒ 60s ä»¥ä¸Šä»¥å‡å°‘æ•°æ®åº“å‹åŠ›

#### `cache_ttl.30d`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **é»˜è®¤å€¼**: `"60s"`
- **è¯´æ˜**: è¿‘ 30 å¤©ï¼ˆ`period=30d`ï¼‰æŸ¥è¯¢çš„ç¼“å­˜æœ‰æ•ˆæœŸ
- **å»ºè®®**: 30d æ•°æ®é‡æœ€å¤§ï¼Œå¯é€‚å½“å¢åŠ åˆ° 120s ä»¥ä¼˜åŒ–æ€§èƒ½

**è®¾è®¡è€ƒé‡**ï¼š
- **çŸ­å‘¨æœŸï¼ˆ90m/24hï¼‰**ï¼šæ•°æ®å˜åŒ–é¢‘ç¹ï¼Œç”¨æˆ·æœŸæœ›å®æ—¶æ€§ï¼Œé»˜è®¤ 10s
- **é•¿å‘¨æœŸï¼ˆ7d/30dï¼‰**ï¼šæ•°æ®é‡å¤§ã€è®¡ç®—å¼€é”€é«˜ï¼Œé»˜è®¤ 60s å¹³è¡¡æ€§èƒ½ä¸æ—¶æ•ˆæ€§
- æ‰€æœ‰å‘¨æœŸçš„ TTL ä¹Ÿä¼šé€šè¿‡ HTTP `Cache-Control` å¤´ä¼ é€’ç»™ CDNï¼ˆå¦‚ Cloudflareï¼‰

**ç¤ºä¾‹é…ç½®**ï¼š
```yaml
# é«˜æ€§èƒ½åœºæ™¯ï¼šå¢åŠ é•¿å‘¨æœŸç¼“å­˜
cache_ttl:
  90m: "10s"
  24h: "10s"
  7d: "120s"   # 2 åˆ†é’Ÿï¼Œå‡å°‘ DB å‹åŠ›
  30d: "180s"  # 3 åˆ†é’Ÿ
```

### å­˜å‚¨é…ç½®

#### SQLiteï¼ˆé»˜è®¤ï¼‰

```yaml
storage:
  type: "sqlite"
  sqlite:
    path: "monitor.db"  # æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼‰
```

**é€‚ç”¨åœºæ™¯**:
- å•æœºéƒ¨ç½²
- å¼€å‘ç¯å¢ƒ
- å°è§„æ¨¡ç›‘æµ‹ï¼ˆ< 100 ä¸ªç›‘æµ‹é¡¹ï¼‰

**é™åˆ¶**:
- ä¸æ”¯æŒå¤šå‰¯æœ¬ï¼ˆæ°´å¹³æ‰©å±•ï¼‰
- K8s ç¯å¢ƒéœ€è¦ PersistentVolume

#### PostgreSQL

```yaml
storage:
  type: "postgres"
  postgres:
    host: "postgres-service"    # æ•°æ®åº“ä¸»æœº
    port: 5432                  # ç«¯å£
    user: "monitor"             # ç”¨æˆ·å
    password: "secret"          # å¯†ç ï¼ˆå»ºè®®ç”¨ç¯å¢ƒå˜é‡ï¼‰
    database: "llm_monitor"     # æ•°æ®åº“å
    sslmode: "require"          # SSL æ¨¡å¼: disable, require, verify-full
    max_open_conns: 50          # æœ€å¤§æ‰“å¼€è¿æ¥æ•°ï¼ˆè‡ªåŠ¨è°ƒæ•´ï¼‰
    max_idle_conns: 10          # æœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼ˆè‡ªåŠ¨è°ƒæ•´ï¼‰
    conn_max_lifetime: "1h"     # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ
```

**è¿æ¥æ± è‡ªåŠ¨è°ƒæ•´**ï¼š
- å¦‚æœæœªé…ç½® `max_open_conns` å’Œ `max_idle_conns`ï¼Œç³»ç»Ÿä¼šæ ¹æ® `enable_concurrent_query` è‡ªåŠ¨è®¾ç½®ï¼š
  - **å¹¶å‘æ¨¡å¼**ï¼ˆ`enable_concurrent_query=true`ï¼‰ï¼š`50` / `10`
  - **ä¸²è¡Œæ¨¡å¼**ï¼ˆ`enable_concurrent_query=false`ï¼‰ï¼š`25` / `5`
- å¦‚æœå·²é…ç½®ï¼Œåˆ™ä½¿ç”¨é…ç½®å€¼ï¼ˆä¸ä¼šè‡ªåŠ¨è°ƒæ•´ï¼‰

**è¿æ¥æ± å¤§å°å»ºè®®**ï¼š

| é…ç½®é¡¹ | è®¡ç®—å…¬å¼ | ç¤ºä¾‹ |
|--------|---------|------|
| `max_open_conns` | `max_concurrency + concurrent_query_limit Ã— å¹¶å‘è¯·æ±‚æ•° + ç¼“å†²` | `15 + 10 Ã— 2 + 5 = 40` |
| `max_idle_conns` | `max_open_conns / 3 ~ 5` | `40 / 4 = 10` |

- **`max_concurrency`**ï¼šæ¢æµ‹å¹¶å‘æ•°ï¼ˆé…ç½®ä¸­çš„ `max_concurrency`ï¼Œé»˜è®¤ 15ï¼‰
- **`concurrent_query_limit`**ï¼šAPI æŸ¥è¯¢å¹¶å‘æ•°ï¼ˆé…ç½®ä¸­çš„ `concurrent_query_limit`ï¼Œé»˜è®¤ 10ï¼‰
- **å¹¶å‘è¯·æ±‚æ•°**ï¼šé¢„æœŸåŒæ—¶è®¿é—® `/api/status` çš„ç”¨æˆ·æ•°

**ç¤ºä¾‹é…ç½®**ï¼ˆ42 ä¸ªç›‘æµ‹é¡¹ï¼Œç”Ÿäº§ç¯å¢ƒï¼‰ï¼š

```yaml
# æ¢æµ‹é…ç½®
max_concurrency: 15        # æ¢æµ‹å¹¶å‘æ•°
stagger_probes: true       # é”™å³°è°ƒåº¦

# API æŸ¥è¯¢ä¼˜åŒ–
enable_concurrent_query: true
concurrent_query_limit: 10

# PostgreSQL è¿æ¥æ± 
storage:
  type: "postgres"
  postgres:
    max_open_conns: 40     # 15 + 10 Ã— 2 + 5 = 40
    max_idle_conns: 10
    conn_max_lifetime: "1h"
```

**é€‚ç”¨åœºæ™¯**:
- Kubernetes å¤šå‰¯æœ¬éƒ¨ç½²
- é«˜å¯ç”¨éœ€æ±‚
- å¤§è§„æ¨¡ç›‘æµ‹ï¼ˆ> 100 ä¸ªç›‘æµ‹é¡¹ï¼‰

**åˆå§‹åŒ–æ•°æ®åº“**:

```sql
CREATE DATABASE llm_monitor;
CREATE USER monitor WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE llm_monitor TO monitor;
```

### æ•°æ®ä¿ç•™ä¸æ¸…ç†

RelayPulse æ”¯æŒè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„å†å²æ•°æ®ï¼Œé¿å…æ•°æ®åº“æ— é™å¢é•¿ã€‚æ¸…ç†åŠŸèƒ½**é»˜è®¤å¯ç”¨**ï¼Œä¿ç•™æœ€è¿‘ 36 å¤©çš„æ•°æ®ã€‚

> **æ³¨æ„**ï¼š`retention` å’Œ `archive` é…ç½®ä¿®æ”¹åéœ€è¦**é‡å¯æœåŠ¡**æ‰èƒ½ç”Ÿæ•ˆï¼ˆä¸æ”¯æŒçƒ­æ›´æ–°ï¼‰ã€‚

#### æ¸…ç†é…ç½®ï¼ˆretentionï¼‰

```yaml
storage:
  type: "postgres"
  # ... å…¶ä»–å­˜å‚¨é…ç½® ...

  retention:
    enabled: true              # æ˜¯å¦å¯ç”¨æ¸…ç†ï¼ˆé»˜è®¤ trueï¼‰
    days: 36                   # ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤ 36ï¼Œå»ºè®®æ¯”ç”¨æˆ·å¯è§çš„ 30 å¤©å¤šå‡ å¤©ç¼“å†²ï¼‰
    cleanup_interval: "1h"     # æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”ï¼ˆé»˜è®¤ 1hï¼‰
    batch_size: 10000          # æ¯æ‰¹åˆ é™¤çš„æœ€å¤§è¡Œæ•°ï¼ˆé»˜è®¤ 10000ï¼‰
    max_batches_per_run: 100   # å•è½®æœ€å¤šæ‰§è¡Œæ‰¹æ¬¡ï¼ˆé»˜è®¤ 100ï¼Œé¿å…é•¿æ—¶é—´å ç”¨ï¼‰
    startup_delay: "1m"        # å¯åŠ¨åå»¶è¿Ÿå¤šä¹…å¼€å§‹é¦–æ¬¡æ¸…ç†ï¼ˆé»˜è®¤ 1mï¼‰
    jitter: 0.2                # è°ƒåº¦æŠ–åŠ¨æ¯”ä¾‹ï¼ˆé»˜è®¤ 0.2ï¼Œé¿å…å¤šå®ä¾‹åŒæ—¶æ‰§è¡Œï¼‰
```

**é…ç½®é¡¹è¯´æ˜**ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `enabled` | `true` | æ˜¯å¦å¯ç”¨æ¸…ç†ä»»åŠ¡ |
| `days` | `36` | ä¿ç•™å¤©æ•°ï¼ˆè¶…è¿‡æ­¤å¤©æ•°çš„æ•°æ®å°†è¢«åˆ é™¤ï¼‰ |
| `cleanup_interval` | `"1h"` | æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš” |
| `batch_size` | `10000` | æ¯æ‰¹åˆ é™¤çš„æœ€å¤§è¡Œæ•° |
| `max_batches_per_run` | `100` | å•è½®æœ€å¤šæ‰§è¡Œæ‰¹æ¬¡ |
| `startup_delay` | `"1m"` | å¯åŠ¨åå»¶è¿Ÿé¦–æ¬¡æ¸…ç† |
| `jitter` | `0.2` | è°ƒåº¦æŠ–åŠ¨æ¯”ä¾‹ï¼ˆ0-1ï¼‰ |

**å¤šå®ä¾‹éƒ¨ç½²**ï¼š
- PostgreSQL ä½¿ç”¨ advisory lock ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå®ä¾‹æ‰§è¡Œæ¸…ç†
- cutoff æ—¶é—´æŒ‰ UTC è®¡ç®—ï¼Œé¿å…æ—¶åŒº/DST å¯¼è‡´è¾¹ç•Œä¸ä¸€è‡´
- SQLite å•è¿æ¥æ¨¡å¼ï¼Œæ— éœ€é¢å¤–å¤„ç†

**ç¦ç”¨æ¸…ç†**ï¼š
```yaml
storage:
  retention:
    enabled: false
```

#### å½’æ¡£é…ç½®ï¼ˆarchiveï¼‰

å½’æ¡£åŠŸèƒ½ç”¨äºå°†è¿‡æœŸæ•°æ®å¯¼å‡ºåˆ°æ–‡ä»¶å¤‡ä»½ï¼Œ**é»˜è®¤ç¦ç”¨**ï¼Œä»… PostgreSQL æ”¯æŒã€‚

```yaml
storage:
  type: "postgres"
  # ... å…¶ä»–å­˜å‚¨é…ç½® ...

  archive:
    enabled: true              # æ˜¯å¦å¯ç”¨å½’æ¡£ï¼ˆé»˜è®¤ falseï¼‰
    output_dir: "./archive"    # å½’æ¡£æ–‡ä»¶è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ ./archiveï¼‰
    format: "csv.gz"           # å½’æ¡£æ ¼å¼ï¼ˆé»˜è®¤ csv.gzï¼Œå¯é€‰ csvï¼‰
    archive_days: 35           # å½’æ¡£å¤šå°‘å¤©å‰çš„æ•°æ®ï¼ˆé»˜è®¤ 35ï¼‰
    backfill_days: 7           # å›æº¯è¡¥é½å¤©æ•°ï¼ˆé»˜è®¤ 7ï¼Œ1=ä»…å½’æ¡£å•æ—¥ï¼‰
    keep_days: 365             # å½’æ¡£æ–‡ä»¶ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤ 365ï¼Œ0=æ°¸ä¹…ï¼‰
```

**é…ç½®é¡¹è¯´æ˜**ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `enabled` | `false` | æ˜¯å¦å¯ç”¨å½’æ¡£ï¼ˆéœ€æ˜¾å¼å¼€å¯ï¼‰ |
| `output_dir` | `"./archive"` | å½’æ¡£æ–‡ä»¶è¾“å‡ºç›®å½• |
| `format` | `"csv.gz"` | å½’æ¡£æ ¼å¼ï¼š`csv` æˆ– `csv.gz` |
| `archive_days` | `35` | å½’æ¡£é˜ˆå€¼å¤©æ•°ï¼ˆå½’æ¡£æ­¤å¤©æ•°ä¹‹å‰çš„æ•°æ®ï¼‰ |
| `backfill_days` | `7` | å›æº¯è¡¥é½å¤©æ•°ï¼ˆæ¯æ¬¡è¿è¡Œæœ€å¤šè¡¥é½å¤šå°‘å¤©çš„ç¼ºå£ï¼‰ |
| `keep_days` | `365` | å½’æ¡£æ–‡ä»¶ä¿ç•™å¤©æ•°ï¼ˆ0=æ°¸ä¹…ï¼‰ |

**å½’æ¡£æµç¨‹**ï¼š
1. å¯åŠ¨åä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡å½’æ¡£æ£€æŸ¥ï¼Œå¹¶åœ¨æ¯å¤©å‡Œæ™¨ 3 ç‚¹ï¼ˆUTCï¼‰æ‰§è¡Œ
2. æ¯æ¬¡è¿è¡Œä»¥ `now - archive_days` ä¸º"æœ€æ–°å¯å½’æ¡£æ—¥"ï¼Œå¹¶åœ¨ `backfill_days` çª—å£å†…é€æ—¥è¡¥é½ç¼ºå¤±çš„å½’æ¡£æ–‡ä»¶
3. PostgreSQL å¤šå®ä¾‹ä½¿ç”¨ advisory lock ç¡®ä¿åŒä¸€å¤©åªä¼šè¢«ä¸€ä¸ªå®ä¾‹å½’æ¡£ï¼ˆæŒ‰æ—¥æœŸäº’æ–¥ï¼Œä¸åŒæ—¥æœŸå¯èƒ½å¹¶è¡Œå½’æ¡£ï¼‰
4. æ–‡ä»¶å‘½åæ ¼å¼ï¼š`probe_history_2024-01-15.csv.gz`ï¼Œå¹¶è‡ªåŠ¨æ¸…ç†è¶…è¿‡ `keep_days` çš„æ—§å½’æ¡£æ–‡ä»¶

**å¤šå®ä¾‹éƒ¨ç½²æ³¨æ„äº‹é¡¹**ï¼š
> **é‡è¦**ï¼šå½’æ¡£æ–‡ä»¶å†™å…¥å®ä¾‹æœ¬åœ°çš„ `output_dir` ç›®å½•ã€‚å¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œå¿…é¡»ç¡®ä¿ï¼š
> - `output_dir` æŒ‚è½½åˆ°**å…±äº«æŒä¹…åŒ–å­˜å‚¨**ï¼ˆå¦‚ NFSã€RWX PVCã€äº‘å­˜å‚¨æŒ‚è½½ç­‰ï¼‰
> - æˆ–è€…åªè®©**å•ä¸ªå®ä¾‹/ç‹¬ç«‹ CronJob** æ‰§è¡Œå½’æ¡£ä»»åŠ¡
>
> å¦åˆ™å½’æ¡£æ–‡ä»¶å¯èƒ½éš Pod/å®¹å™¨é‡å»ºè€Œä¸¢å¤±ï¼Œå¯¼è‡´å¤‡ä»½ä¸å®Œæ•´ã€‚

**é…ç½®åè°ƒ**ï¼š
- `archive_days` åº”å°äº `retention.days`ï¼Œå¦åˆ™æ•°æ®å¯èƒ½åœ¨å½’æ¡£å‰è¢«æ¸…ç†
- å¦‚å¸Œæœ›"åœæœºè¡¥é½çª—å£"å†…çš„æ•°æ®ä¹Ÿèƒ½ç¨³å®šå¯¼å‡ºï¼Œå»ºè®® `retention.days >= archive_days + backfill_days`
- æ¨èé…ç½®ï¼š`archive_days: 35`ï¼Œ`backfill_days: 7`ï¼Œ`retention.days: 43`

**ç¤ºä¾‹ï¼šå®Œæ•´çš„æ¸…ç†+å½’æ¡£é…ç½®**ï¼š
```yaml
storage:
  type: "postgres"
  postgres:
    host: "localhost"
    port: 5432
    user: "monitor"
    password: "secret"
    database: "llm_monitor"

  retention:
    enabled: true
    days: 43                   # >= archive_days + backfill_days
    cleanup_interval: "1h"

  archive:
    enabled: true
    output_dir: "./archive"
    format: "csv.gz"
    archive_days: 35
    backfill_days: 7           # æ”¯æŒåœæœº 7 å¤©åè‡ªåŠ¨è¡¥é½
    keep_days: 365
```

**æ‰‹åŠ¨æ¸…ç†å‘½ä»¤**ï¼ˆå¦‚éœ€æ‰‹åŠ¨æ¸…ç†ï¼‰ï¼š
```sql
-- PostgreSQL: åˆ é™¤ 30 å¤©å‰çš„æ•°æ®
DELETE FROM probe_history
WHERE timestamp < EXTRACT(EPOCH FROM NOW() - INTERVAL '30 days');

-- SQLite: åˆ é™¤ 30 å¤©å‰çš„æ•°æ®
DELETE FROM probe_history
WHERE timestamp < strftime('%s', 'now', '-30 days');
```

### ç›‘æµ‹é¡¹é…ç½®

#### å¿…å¡«å­—æ®µ

##### `provider`
- **ç±»å‹**: string
- **è¯´æ˜**: æœåŠ¡å•†æ ‡è¯†ï¼ˆç”¨äºåˆ†ç»„å’Œæ˜¾ç¤ºï¼‰
- **ç¤ºä¾‹**: `"openai"`, `"anthropic"`, `"88code"`

##### `service`
- **ç±»å‹**: string
- **è¯´æ˜**: æœåŠ¡ç±»å‹æ ‡è¯†
- **ç¤ºä¾‹**: `"gpt-4"`, `"claude"`, `"cc"`, `"cx"`

##### `category`
- **ç±»å‹**: string
- **è¯´æ˜**: åˆ†ç±»æ ‡è¯†
- **å¯é€‰å€¼**: `"commercial"`ï¼ˆæ¨å¹¿ç«™ï¼‰, `"public"`ï¼ˆå…¬ç›Šç«™ï¼‰

##### `sponsor`
- **ç±»å‹**: string
- **è¯´æ˜**: æä¾› API Key çš„èµåŠ©è€…åç§°
- **ç¤ºä¾‹**: `"å›¢é˜Ÿè‡ªæœ‰"`, `"ç”¨æˆ·æèµ "`, `"John Doe"`

##### `url`
- **ç±»å‹**: string
- **è¯´æ˜**: å¥åº·æ£€æŸ¥çš„ HTTP ç«¯ç‚¹
- **ç¤ºä¾‹**: `"https://api.openai.com/v1/chat/completions"`

##### `method`
- **ç±»å‹**: string
- **è¯´æ˜**: HTTP è¯·æ±‚æ–¹æ³•
- **å¯é€‰å€¼**: `"GET"`, `"POST"`, `"PUT"`, `"DELETE"`, `"PATCH"`

#### å¯é€‰å­—æ®µ

##### `provider_slug`
- **ç±»å‹**: string
- **è¯´æ˜**: æœåŠ¡å•†çš„ URL çŸ­æ ‡è¯†ï¼Œç”¨äºç”Ÿæˆ `/p/<slug>` ä¸“å±é¡µé¢é“¾æ¥
- **é»˜è®¤å€¼**: æœªé…ç½®æ—¶è‡ªåŠ¨ä½¿ç”¨ `provider` çš„å°å†™å½¢å¼
- **æ ¼å¼è¦æ±‚**: ä»…å…è®¸å°å†™å­—æ¯ (a-z)ã€æ•°å­— (0-9)ã€è¿å­—ç¬¦ (-)ï¼Œä¸èƒ½ä»¥è¿å­—ç¬¦å¼€å¤´æˆ–ç»“å°¾ï¼Œä¸èƒ½æœ‰è¿ç»­è¿å­—ç¬¦
- **ç¤ºä¾‹**: `"88code"`, `"openai"`, `"my-provider"`

##### `provider_url`
- **ç±»å‹**: string
- **è¯´æ˜**: æœåŠ¡å•†å®˜ç½‘é“¾æ¥ï¼ˆå¯é€‰ï¼‰ï¼Œå‰ç«¯å±•ç¤ºä¸ºå¤–éƒ¨è·³è½¬
- **æ ¼å¼è¦æ±‚**: å¿…é¡»æ˜¯ `http://` æˆ– `https://` åè®®
- **ç¤ºä¾‹**: `"https://88code.com"`, `"https://openai.com"`

##### `sponsor_url`
- **ç±»å‹**: string
- **è¯´æ˜**: èµåŠ©è€…å±•ç¤ºç”¨é“¾æ¥ï¼ˆå¯é€‰ï¼‰ï¼Œä¾‹å¦‚ä¸ªäººä¸»é¡µæˆ–ç»„ç»‡ç½‘ç«™
- **æ ¼å¼è¦æ±‚**: å¿…é¡»æ˜¯ `http://` æˆ– `https://` åè®®
- **ç¤ºä¾‹**: `"https://example.com/sponsor"`

##### `sponsor_level`
- **ç±»å‹**: string
- **è¯´æ˜**: èµåŠ©å•†ç­‰çº§å¾½ç« ï¼ˆå¯é€‰ï¼‰ï¼Œåœ¨å‰ç«¯æ˜¾ç¤ºå¯¹åº”å›¾æ ‡
- **æœ‰æ•ˆå€¼**:
  | å€¼ | åç§° | å›¾æ ‡ | è¯´æ˜ |
  |---|---|---|---|
  | `basic` | èŠ‚ç‚¹æ”¯æŒ | ğŸ”» | å·²èµåŠ©é«˜é¢‘ç›‘æµ‹èµ„æº |
  | `advanced` | æ ¸å¿ƒæœåŠ¡å•† | â¬¢ | å¤šçº¿è·¯æ·±åº¦ç›‘æµ‹ |
  | `enterprise` | å…¨çƒä¼™ä¼´ | ğŸ’  | RelayPulse é¡¶çº§èµåŠ©å•† |
- **ç¤ºä¾‹**: `"advanced"`

##### `channel`
- **ç±»å‹**: string
- **è¯´æ˜**: ä¸šåŠ¡é€šé“æ ‡è¯†ï¼ˆç”¨äºåŒºåˆ†åŒä¸€æœåŠ¡çš„ä¸åŒæ¸ é“ï¼‰
- **ç¤ºä¾‹**: `"vip"`, `"free"`, `"premium"`

##### `model`
- **ç±»å‹**: string
- **è¯´æ˜**: æ¨¡å‹åç§°ï¼Œç”¨äºå¤šæ¨¡å‹ç›‘æµ‹ç»„åŠŸèƒ½
- **ä½¿ç”¨åœºæ™¯**:
  - åŒä¸€ä¸ª `provider + service + channel` ä¸‹ç›‘æµ‹å¤šä¸ªä¸åŒæ¨¡å‹
  - éœ€è¦é…åˆ `parent` å­—æ®µä½¿ç”¨ä»¥å»ºç«‹çˆ¶å­å…³ç³»
- **çº¦æŸ**:
  - åŒä¸€ `provider + service + channel + model` ç»„åˆå¿…é¡»å”¯ä¸€
  - å¦‚æœé…ç½®äº† `parent`ï¼Œåˆ™ `model` ä¸ºå¿…å¡«
- **ç¤ºä¾‹**: `"claude-sonnet-4-20250514"`, `"gpt-4o"`

##### `parent`
- **ç±»å‹**: string
- **è¯´æ˜**: çˆ¶é€šé“å¼•ç”¨ï¼Œæ ¼å¼ä¸º `provider/service/channel`ï¼Œç”¨äºå»ºç«‹çˆ¶å­ç»§æ‰¿å…³ç³»
- **ç»§æ‰¿è§„åˆ™**:
  - å­é¡¹**å¿…å¡«** `parent` å’Œ `model`
  - å…¶ä»–æ‰€æœ‰å­—æ®µå‡ä»çˆ¶é€šé“ç»§æ‰¿ï¼Œå­é¡¹å¯æŒ‰éœ€è¦†ç›–
  - `provider/service/channel` ä» parent è·¯å¾„è‡ªåŠ¨ç»§æ‰¿ï¼Œä¸æ”¯æŒè¦†ç›–ä¸ºä¸åŒå€¼
  - `interval/slow_latency/timeout` ä»çˆ¶é€šé“ç»§æ‰¿ï¼ˆåŒ…æ‹¬è§£æåçš„ Duration å€¼ï¼‰
  - `headers` é‡‡ç”¨åˆå¹¶ç­–ç•¥ï¼ˆçˆ¶ä¸ºåŸºç¡€ï¼Œå­è¦†ç›–åŒå keyï¼‰
  - `disabled/hidden` é‡‡ç”¨çº§è”é€»è¾‘ï¼ˆçˆ¶ç¦ç”¨/éšè—åˆ™å­ä¹Ÿç¦ç”¨/éšè—ï¼‰
- **çº¦æŸ**:
  - çˆ¶é€šé“å¿…é¡»å­˜åœ¨ä¸”é…ç½®äº† `model` å­—æ®µ
  - ä¸å…è®¸å¾ªç¯å¼•ç”¨
  - åŒä¸€ `provider/service/channel` ä¸‹åªèƒ½æœ‰ä¸€ä¸ªçˆ¶å±‚
- **ç¤ºä¾‹**: `"88code/cc/vip"`

##### å¤šæ¨¡å‹ç›‘æµ‹ç»„é…ç½®ç¤ºä¾‹

```yaml
# çˆ¶é€šé“ï¼šå®šä¹‰å…¬å…±é…ç½®ï¼ˆå®Œæ•´é…ç½®ï¼‰
- provider: "88code"
  service: "cc"
  channel: "vip"
  model: "claude-sonnet-4-20250514"  # çˆ¶å±‚å¿…é¡»é…ç½® model
  category: "commercial"
  sponsor: "å›¢é˜Ÿ"
  sponsor_level: "advanced"
  url: "https://api.88code.com/v1/chat/completions"
  method: "POST"
  headers:
    Authorization: "Bearer {{API_KEY}}"
    Content-Type: "application/json"
  body: |
    {"model": "{{MODEL}}", "messages": [{"role": "user", "content": "hi"}]}
  success_contains: "content"

# å­é€šé“ï¼šå®Œæ•´ç»§æ‰¿ï¼Œåªéœ€ parent + modelï¼ˆ+ å·®å¼‚å­—æ®µï¼‰
- model: "claude-opus-4-20250514"
  parent: "88code/cc/vip"  # è‡ªåŠ¨ç»§æ‰¿ provider/service/channel åŠå…¶ä»–é…ç½®
  # category ä¼šä»çˆ¶é€šé“ç»§æ‰¿ï¼Œä¹Ÿå¯æ˜¾å¼è¦†ç›–
  # ä»…è¦†ç›–ä¸åŒçš„ bodyï¼ˆä½¿ç”¨ {{MODEL}} å ä½ç¬¦æ—¶ç”šè‡³å¯ä»¥çœç•¥ï¼‰
  body: |
    {"model": "claude-opus-4-20250514", "messages": [{"role": "user", "content": "hi"}]}
```

**å‰ç«¯æ˜¾ç¤º**ï¼š
- çƒ­åŠ›å›¾é‡‡ç”¨å‚ç›´åˆ†å±‚æ˜¾ç¤ºï¼Œçˆ¶å±‚åœ¨ä¸Šï¼Œå­å±‚åœ¨ä¸‹
- ç»„çº§çŠ¶æ€å–æ‰€æœ‰å±‚çš„æœ€å·®çŠ¶æ€ï¼ˆçº¢ > é»„ > ç»¿ï¼‰
- ç»„çº§å¯ç”¨ç‡å–æ‰€æœ‰å±‚çš„æœ€å°å€¼

##### `price_min`
- **ç±»å‹**: numberï¼ˆå¯é€‰ï¼‰
- **è¯´æ˜**: æœåŠ¡å•†å£°æ˜çš„å‚è€ƒå€ç‡ä¸‹é™
- **çº¦æŸ**: ä¸èƒ½ä¸ºè´Ÿæ•°ï¼›è‹¥åŒæ—¶é…ç½® `price_max`ï¼Œåˆ™ `price_min` å¿…é¡» â‰¤ `price_max`
- **ç¤ºä¾‹**: `0.05`

##### `price_max`
- **ç±»å‹**: numberï¼ˆå¯é€‰ï¼‰
- **è¯´æ˜**: æœåŠ¡å•†å£°æ˜çš„å‚è€ƒå€ç‡ï¼ˆç”¨äºæ’åºå’Œæ˜¾ç¤ºï¼‰
- **çº¦æŸ**: ä¸èƒ½ä¸ºè´Ÿæ•°ï¼›è‹¥åŒæ—¶é…ç½® `price_min`ï¼Œåˆ™ `price_max` å¿…é¡» â‰¥ `price_min`
- **æ’åº**: æŒ‰æ­¤å€¼æ’åºï¼ˆç”¨æˆ·å…³å¿ƒ"æœ€å¤šä»˜å¤šå°‘"ï¼‰ï¼Œæœªé…ç½®çš„æ’æœ€å
- **æ˜¾ç¤ºé€»è¾‘**:
  - è‹¥ `price_min == price_max`ï¼šåªæ˜¾ç¤ºå•ä¸ªå€¼
  - è‹¥ä¸åŒï¼šæ˜¾ç¤ºä¸­å¿ƒå€¼ + åŒºé—´ï¼Œå¦‚ `0.125 / 0.05~0.2`
- **ç¤ºä¾‹**: `0.2`ï¼ˆé…åˆ `price_min: 0.05` æ˜¾ç¤ºä¸º "0.125 / 0.05~0.2"ï¼‰

##### `listed_since`
- **ç±»å‹**: stringï¼ˆå¯é€‰ï¼Œæ ¼å¼ `YYYY-MM-DD`ï¼‰
- **è¯´æ˜**: æœåŠ¡å•†æ”¶å½•æ—¥æœŸï¼Œç”¨äºåœ¨å‰ç«¯æ˜¾ç¤º"æ”¶å½•å¤©æ•°"
- **çº¦æŸ**: å¿…é¡»ä¸ºæœ‰æ•ˆæ—¥æœŸæ ¼å¼ï¼Œå¦‚ `"2024-06-15"`
- **æ’åº**: æ”¯æŒåœ¨è¡¨æ ¼ä¸­æŒ‰æ”¶å½•å¤©æ•°æ’åºï¼Œæœªé…ç½®çš„æ’æœ€å
- **ç¤ºä¾‹**: `"2024-06-15"`ï¼ˆAPI è¿”å› `listed_days` ä¸ºä»è¯¥æ—¥æœŸåˆ°ä»Šå¤©çš„å¤©æ•°ï¼‰

##### `api_key`
- **ç±»å‹**: string
- **è¯´æ˜**: API å¯†é’¥ï¼ˆå¼ºçƒˆå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ä»£æ›¿ï¼‰
- **ç¤ºä¾‹**: `"sk-xxx"`

##### `env_var_name`
- **ç±»å‹**: stringï¼ˆå¯é€‰ï¼‰
- **è¯´æ˜**: è‡ªå®šä¹‰ç¯å¢ƒå˜é‡åï¼Œç”¨äºè¦†ç›–è‡ªåŠ¨ç”Ÿæˆçš„ç¯å¢ƒå˜é‡å‘½åè§„åˆ™
- **ä½¿ç”¨åœºæ™¯**:
  - **ä¸­æ–‡ channel åç§°**ï¼šå¦‚ `"cxä¸“ç”¨"`ã€`"ccæµ‹è¯•key"` ç­‰ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„å˜é‡åè¯­ä¹‰ä¸æ¸…æ™°
  - **channel åç§°å†²çª**ï¼šå¦‚åŒä¸€ provider æœ‰å¤šä¸ªç›¸ä¼¼ channelï¼ˆ`"ccä¸“ç”¨"` vs `"ccä¸“ç”¨-ç‰¹ä»·"`ï¼‰
  - **ç‰¹æ®Šå­—ç¬¦å¤„ç†**ï¼šchannel åŒ…å«æ— æ³•æ¸…æ™°æ˜ å°„ä¸ºå˜é‡åçš„å­—ç¬¦
- **ä¼˜å…ˆçº§è§„åˆ™**:
  1. ğŸ¥‡ **è‡ªå®šä¹‰ `env_var_name`**ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
  2. ğŸ¥ˆ **æ ‡å‡†æ ¼å¼ï¼ˆå« channelï¼‰**ï¼š`MONITOR_<PROVIDER>_<SERVICE>_<CHANNEL>_API_KEY`
  3. ğŸ¥‰ **æ ‡å‡†æ ¼å¼ï¼ˆä¸å« channelï¼‰**ï¼š`MONITOR_<PROVIDER>_<SERVICE>_API_KEY`ï¼ˆå‘åå…¼å®¹ï¼‰
- **ç¤ºä¾‹**:
  ```yaml
  # ç¤ºä¾‹1ï¼šä¸­æ–‡ channelï¼Œè‡ªå®šä¹‰è¯­ä¹‰åŒ–è‹±æ–‡åç§°
  - provider: "duckcoding"
    service: "cx"
    channel: "cxä¸“ç”¨"
    env_var_name: "MONITOR_DUCKCODING_CX_CX_DEDICATED_API_KEY"
    # ...

  # ç¤ºä¾‹2ï¼šè§£å†³åŒåå†²çª
  - provider: "duckcoding"
    service: "cc"
    channel: "ccä¸“ç”¨"
    env_var_name: "MONITOR_DUCKCODING_CC_CC_DEDICATED_API_KEY"

  - provider: "duckcoding"
    service: "cc"
    channel: "ccä¸“ç”¨-ç‰¹ä»·"
    env_var_name: "MONITOR_DUCKCODING_CC_CC_DISCOUNT_API_KEY"  # é¿å…å†²çª
  ```

##### `headers`
- **ç±»å‹**: map[string]string
- **è¯´æ˜**: è‡ªå®šä¹‰è¯·æ±‚å¤´
- **å ä½ç¬¦**: `{{API_KEY}}` ä¼šè¢«æ›¿æ¢ä¸ºå®é™…çš„ API Key
- **ç¤ºä¾‹**:
  ```yaml
  headers:
    Authorization: "Bearer {{API_KEY}}"
    Content-Type: "application/json"
    X-Custom-Header: "value"
  ```

##### `body`
- **ç±»å‹**: string æˆ– `!include` å¼•ç”¨
- **è¯´æ˜**: è¯·æ±‚ä½“å†…å®¹
- **å ä½ç¬¦**: `{{API_KEY}}` ä¼šè¢«æ›¿æ¢
- **ç¤ºä¾‹**:
  ```yaml
  # å†…è”æ–¹å¼
  body: |
    {
      "model": "gpt-4",
      "messages": [{"role": "user", "content": "test"}],
      "max_tokens": 1
    }

  # å¼•ç”¨å¤–éƒ¨æ–‡ä»¶
  body: "!include data/gpt4_request.json"
  ```

##### `success_contains`
- **ç±»å‹**: string
- **è¯´æ˜**: å“åº”ä½“å¿…é¡»åŒ…å«çš„å…³é”®å­—ï¼ˆç”¨äºè¯­ä¹‰éªŒè¯ï¼‰
- **ç¤ºä¾‹**: `"content"`, `"choices"`, `"success"`, `"pong"`
- **è¡Œä¸º**:
  - ä»…åœ¨ HTTP è¿”å› **2xx çŠ¶æ€ç **ã€ä¸”é 429 é™æµåœºæ™¯ä¸‹ç”Ÿæ•ˆï¼›
  - å½“å“åº”å†…å®¹ï¼ˆåŒ…å«å¸¸è§æµå¼ SSE å“åº”èšåˆåçš„æ–‡æœ¬ï¼‰**ä¸åŒ…å«**æ­¤å…³é”®å­—æ—¶ï¼Œ
    ä¼šå°†è¯¥æ¬¡æ¢æµ‹æ ‡è®°ä¸º **çº¢è‰²ä¸å¯ç”¨**ï¼ˆ`content_mismatch`ï¼‰ï¼Œå³ä½¿ HTTP çŠ¶æ€ç æ˜¯ 2xxï¼›
  - æ”¯æŒå¸¸è§çš„æµå¼å“åº”æ ¼å¼ï¼ˆå¦‚ Anthropic çš„ `content_block_delta`ã€
    OpenAI çš„ `choices[].delta.content`ï¼‰ï¼Œä¼šè‡ªåŠ¨æ‹¼æ¥å¢é‡æ–‡æœ¬å†è¿›è¡Œå…³é”®å­—åŒ¹é…ã€‚

##### `interval`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **è¯´æ˜**: è¯¥ç›‘æµ‹é¡¹çš„è‡ªå®šä¹‰å·¡æ£€é—´éš”ï¼ˆå¯é€‰ï¼‰ï¼Œè¦†ç›–å…¨å±€ `interval`
- **ç¤ºä¾‹**: `"30s"`, `"1m"`, `"5m"`
- **ä½¿ç”¨åœºæ™¯**:
  - **é«˜é¢‘ç›‘æµ‹**ï¼šä»˜è´¹æœåŠ¡å•†éœ€è¦æ›´çŸ­çš„ç›‘æµ‹é—´éš”ï¼ˆå¦‚ `"1m"`ï¼‰
  - **ä½é¢‘ç›‘æµ‹**ï¼šæˆæœ¬æ•æ„Ÿæˆ–ç¨³å®šæœåŠ¡ä½¿ç”¨æ›´é•¿é—´éš”ï¼ˆå¦‚ `"15m"`ï¼‰
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  interval: "5m"  # å…¨å±€é»˜è®¤ 5 åˆ†é’Ÿ
  monitors:
    - provider: "é«˜ä¼˜å…ˆçº§æœåŠ¡å•†"
      interval: "1m"   # è¦†ç›–ï¼šæ¯ 1 åˆ†é’Ÿç›‘æµ‹ä¸€æ¬¡
      # ...
    - provider: "æ™®é€šæœåŠ¡å•†"
      # ä¸é…ç½® intervalï¼Œä½¿ç”¨å…¨å±€ 5 åˆ†é’Ÿ
      # ...
  ```

##### `slow_latency`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **è¯´æ˜**: è¯¥ç›‘æµ‹é¡¹çš„è‡ªå®šä¹‰æ…¢è¯·æ±‚é˜ˆå€¼ï¼ˆå¯é€‰ï¼‰ï¼Œè¦†ç›– `slow_latency_by_service` å’Œå…¨å±€ `slow_latency`
- **ä¼˜å…ˆçº§**: `monitor.slow_latency` > `slow_latency_by_service` > å…¨å±€ `slow_latency`
- **ç¤ºä¾‹**: `"5s"`, `"15s"`, `"30s"`
- **ä½¿ç”¨åœºæ™¯**:
  - åŒä¸€æœåŠ¡çš„ä¸åŒé€šé“ä½¿ç”¨ä¸åŒçš„æµ‹è¯•æ¨¡å‹æˆ– payloadï¼Œå“åº”æ—¶é—´å·®å¼‚å¤§
  - ç‰¹å®šé€šé“éœ€è¦æ›´å®½æ¾æˆ–æ›´ä¸¥æ ¼çš„å»¶è¿Ÿé˜ˆå€¼
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  slow_latency: "5s"  # å…¨å±€é»˜è®¤ 5 ç§’
  slow_latency_by_service:
    cc: "15s"  # Claude Code æœåŠ¡é»˜è®¤ 15 ç§’
  monitors:
    - provider: "88code"
      service: "cc"
      channel: "vip3"
      slow_latency: "20s"  # è¯¥é€šé“ä½¿ç”¨æ›´å¤§æ¨¡å‹ï¼Œå…è®¸ 20 ç§’
    - provider: "88code"
      service: "cc"
      channel: "standard"
      # ä¸é…ç½®ï¼Œä½¿ç”¨ slow_latency_by_service çš„ 15 ç§’
  ```

##### `timeout`
- **ç±»å‹**: string (Go duration æ ¼å¼)
- **è¯´æ˜**: è¯¥ç›‘æµ‹é¡¹çš„è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼ˆå¯é€‰ï¼‰ï¼Œè¦†ç›– `timeout_by_service` å’Œå…¨å±€ `timeout`
- **ä¼˜å…ˆçº§**: `monitor.timeout` > `timeout_by_service` > å…¨å±€ `timeout`
- **ç¤ºä¾‹**: `"10s"`, `"30s"`, `"1m"`
- **ä½¿ç”¨åœºæ™¯**:
  - ç‰¹å®šé€šé“çš„ API å“åº”è¾ƒæ…¢ï¼Œéœ€è¦æ›´é•¿è¶…æ—¶
  - æµ‹è¯• payload è¾ƒå¤§ï¼Œéœ€è¦æ›´å¤šå¤„ç†æ—¶é—´
- **æ³¨æ„**: å¦‚æœ `slow_latency >= timeout`ï¼Œç³»ç»Ÿä¼šæ‰“å°è­¦å‘Šï¼Œå› ä¸ºæ…¢å“åº”é»„ç¯å¯èƒ½ä¸ä¼šè§¦å‘
- **é…ç½®ç¤ºä¾‹**:
  ```yaml
  timeout: "10s"  # å…¨å±€é»˜è®¤ 10 ç§’
  timeout_by_service:
    cc: "30s"  # Claude Code æœåŠ¡é»˜è®¤ 30 ç§’
  monitors:
    - provider: "88code"
      service: "cc"
      channel: "vip3"
      timeout: "45s"  # è¯¥é€šé“å…è®¸ 45 ç§’è¶…æ—¶
      slow_latency: "20s"  # é…å¥—çš„æ…¢è¯·æ±‚é˜ˆå€¼
  ```

##### `hidden`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: ä¸´æ—¶ä¸‹æ¶è¯¥ç›‘æµ‹é¡¹ï¼ˆéšè—ä½†ç»§ç»­ç›‘æµ‹ï¼‰
- **è¡Œä¸º**:
  - è°ƒåº¦å™¨ç»§ç»­æ¢æµ‹ï¼Œå­˜å‚¨ç»“æœï¼ˆç”¨äºæ•´æ”¹è¯æ®ï¼‰
  - API `/api/status` é»˜è®¤ä¸è¿”å›ï¼ˆå¯åŠ  `?include_hidden=true` è°ƒè¯•ï¼‰
  - å‰ç«¯ä¸å±•ç¤º
  - sitemap ä¸åŒ…å«
- **ç¤ºä¾‹**:
  ```yaml
  - provider: "é—®é¢˜å•†å®¶"
    service: "cc"
    hidden: true
    hidden_reason: "æœåŠ¡è´¨é‡ä¸è¾¾æ ‡ï¼Œå¾…æ•´æ”¹"
  ```

##### `hidden_reason`
- **ç±»å‹**: string
- **è¯´æ˜**: ä¸‹æ¶åŸå› ï¼ˆå¯é€‰ï¼Œç”¨äºè¿ç»´å®¡è®¡ï¼‰
- **ç¤ºä¾‹**: `"æœåŠ¡è´¨é‡ä¸è¾¾æ ‡ï¼Œå¾…æ•´æ”¹"`, `"è¯¥é€šé“ä¸´æ—¶ç»´æŠ¤"`

##### `disabled`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: å½»åº•åœç”¨è¯¥ç›‘æµ‹é¡¹ï¼ˆä¸æ¢æµ‹ã€ä¸å­˜å‚¨ã€ä¸å±•ç¤ºï¼‰
- **è¡Œä¸º**:
  - è°ƒåº¦å™¨ä¸åˆ›å»ºä»»åŠ¡ï¼Œä¸æ¢æµ‹
  - ä¸å†™å…¥æ•°æ®åº“
  - API `/api/status` ä¸è¿”å›ï¼ˆå³ä½¿åŠ  `?include_hidden=true` ä¹Ÿä¸è¿”å›ï¼‰
  - å‰ç«¯ä¸å±•ç¤º
  - sitemap ä¸åŒ…å«
- **é€‚ç”¨åœºæ™¯**: å•†å®¶å·²å½»åº•å…³é—­ã€ä¸å†éœ€è¦ç›‘æµ‹
- **ç¤ºä¾‹**:
  ```yaml
  - provider: "å·²å…³ç«™å•†å®¶"
    service: "cc"
    disabled: true
    disabled_reason: "å•†å®¶å·²è·‘è·¯"
  ```

##### `disabled_reason`
- **ç±»å‹**: string
- **è¯´æ˜**: åœç”¨åŸå› ï¼ˆå¯é€‰ï¼Œç”¨äºè¿ç»´å®¡è®¡ï¼‰
- **ç¤ºä¾‹**: `"å•†å®¶å·²è·‘è·¯"`, `"æœåŠ¡æ°¸ä¹…å…³é—­"`

### å¾½æ ‡ç³»ç»Ÿé…ç½®

ç”¨äºåœ¨ç›‘æµ‹é¡¹ä¸Šæ˜¾ç¤ºå„ç±»ä¿¡æ¯å¾½æ ‡ï¼ˆå¦‚èµåŠ©å•†ç­‰çº§ã€åˆ†ç±»æ ‡ç­¾ã€é£é™©è­¦å‘Šã€ç›‘æµ‹é¢‘ç‡ã€API Key æ¥æºç­‰ï¼‰ã€‚

#### `enable_badges`
- **ç±»å‹**: boolean
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: å¾½æ ‡ç³»ç»Ÿæ€»å¼€å…³ï¼Œæ§åˆ¶**æ‰€æœ‰**å¾½æ ‡ç±»å‹çš„æ˜¾ç¤º
- **è¡Œä¸º**:
  - `true`: å¯ç”¨å¾½æ ‡ç³»ç»Ÿï¼Œæ˜¾ç¤ºæ‰€æœ‰å¾½æ ‡
  - `false`: ç¦ç”¨å¾½æ ‡ç³»ç»Ÿï¼Œéšè—æ‰€æœ‰å¾½æ ‡ï¼ˆAPI å“åº”ä¸­ç›¸å…³å­—æ®µè¢«æ¸…ç©ºï¼‰
- **å½±å“èŒƒå›´**: æ­¤å¼€å…³æ§åˆ¶ä»¥ä¸‹æ‰€æœ‰å¾½æ ‡ç±»å‹ï¼š
  | å¾½æ ‡ç±»å‹ | è¯´æ˜ | `enable_badges: false` æ—¶ |
  |---------|------|--------------------------|
  | èµåŠ©å•†å¾½æ ‡ | basic/advanced/enterprise ç­‰çº§ | éšè— |
  | åˆ†ç±»æ ‡ç­¾ | å…¬ç›Šç«™ã€Œç›Šã€æ ‡ç­¾ | éšè— |
  | é£é™©å¾½æ ‡ | é£é™©è­¦å‘Šæ ‡è¯† | éšè— |
  | ç›‘æµ‹é¢‘ç‡ | ç›‘æµ‹é—´éš”æŒ‡ç¤ºå™¨ | éšè— |
  | é€šç”¨å¾½æ ‡ | API Key æ¥æºç­‰è‡ªå®šä¹‰å¾½æ ‡ | éšè— |
- **é»˜è®¤å¾½æ ‡**: å¯ç”¨åï¼Œæœªé…ç½®ä»»ä½•é€šç”¨å¾½æ ‡æ—¶è‡ªåŠ¨æ˜¾ç¤º"å®˜æ–¹ API Key"ï¼ˆ`api_key_official`ï¼‰å¾½æ ‡
- **è¦†ç›–è§„åˆ™**: æ‰‹å·¥é…ç½®çš„å¾½æ ‡ä¼š**å®Œå…¨è¦†ç›–**é»˜è®¤å¾½æ ‡ï¼ˆä¸æ˜¯åˆå¹¶ï¼‰
- **æ³¨æ„**: `category` å­—æ®µä»ä¼šè¿”å›ç”¨äºç­›é€‰åŠŸèƒ½ï¼Œä»…è§†è§‰æ ‡ç­¾è¢«éšè—

**ç¤ºä¾‹**:
```yaml
# å¯ç”¨å¾½æ ‡ç³»ç»Ÿ
enable_badges: true

# åœºæ™¯ 1ï¼šæ— é…ç½® â†’ è‡ªåŠ¨æ˜¾ç¤º api_key_official + ç›‘æµ‹é¢‘ç‡
monitors:
  - provider: "Example"
    service: "api"
    # badges æœªé…ç½®ï¼Œè‡ªåŠ¨æ³¨å…¥é»˜è®¤å¾½æ ‡

# åœºæ™¯ 2ï¼šæ‰‹å·¥é…ç½® â†’ è¦†ç›–é»˜è®¤å¾½æ ‡
monitors:
  - provider: "Example"
    service: "api"
    badges:
      - "api_key_user"  # é…ç½®åï¼Œä¸å†æ˜¾ç¤º api_key_official
```

#### å¾½æ ‡ç±»å‹è¯´æ˜

| ç±»å‹ (kind) | è¯´æ˜ | ç¤ºä¾‹å›¾æ ‡ |
|-------------|------|----------|
| `source` | æ•°æ®/Key æ¥æº | ç”¨æˆ·è½®å»“ã€ç›¾ç‰Œå‹¾å· |
| `info` | ä¿¡æ¯æç¤º | åœ†å½¢å¸¦ i |
| `feature` | åŠŸèƒ½ç‰¹æ€§ | é—ªç”µç¬¦å· |

| æ ·å¼ (variant) | é¢œè‰² | é€‚ç”¨åœºæ™¯ |
|----------------|------|----------|
| `default` | ç°è‰² | ä¸€èˆ¬ä¿¡æ¯ï¼ˆçœŸæ­£ä¸­æ€§æˆ–ç¦ç”¨çŠ¶æ€ï¼Œè¾ƒå°‘ä½¿ç”¨ï¼‰ |
| `success` | ç»¿è‰² | æ­£å‘ä¿¡æ¯ï¼ˆå®˜æ–¹ APIã€åŠŸèƒ½æ”¯æŒï¼‰ |
| `warning` | é»„è‰² | è­¦å‘Šä¿¡æ¯ |
| `danger` | çº¢è‰² | é£é™©ä¿¡æ¯ |
| `info` | è“è‰² | ä¿¡æ¯ç±»ï¼ˆç¤¾åŒºè´¡çŒ®ã€ç”¨æˆ·æä¾›çš„ Keyï¼‰ |

#### å…¨å±€å¾½æ ‡å®šä¹‰ (`badge_definitions`)

å®šä¹‰æ‰€æœ‰å¯å¤ç”¨çš„å¾½æ ‡ï¼Œåœ¨ `badge_providers` æˆ– `monitors.badges` ä¸­é€šè¿‡ `id` å¼•ç”¨ï¼š

```yaml
badge_definitions:
  # API Key æ¥æºç±»å¾½æ ‡
  api_key_user:
    kind: "source"       # ç±»å‹ï¼šsource/info/feature
    variant: "info"      # æ ·å¼ï¼šdefault/success/warning/danger/info
    weight: 50           # æ’åºæƒé‡ï¼Œæ•°å€¼è¶Šå¤§è¶Šé å‰ï¼ˆé»˜è®¤ 0ï¼‰
  api_key_official:
    kind: "source"
    variant: "success"   # ç»¿è‰²å¾½æ ‡ï¼Œè¡¨ç¤ºå®˜æ–¹ API
    weight: 80           # å®˜æ–¹ API æ’åœ¨ç”¨æˆ·æäº¤ä¹‹å‰
  # åŠŸèƒ½ç‰¹æ€§ç±»å¾½æ ‡
  stream_support:
    kind: "feature"
    variant: "success"
    weight: 50
    url: "https://docs.example.com/streaming"  # å¯é€‰ï¼šç‚¹å‡»è·³è½¬é“¾æ¥
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `kind` | string | æ˜¯ | - | å¾½æ ‡ç±»å‹ï¼š`source`/`info`/`feature` |
| `variant` | string | å¦ | `default` | æ ·å¼å˜ä½“ï¼š`default`/`success`/`warning`/`danger`/`info` |
| `weight` | number | å¦ | `0` | æ’åºæƒé‡ï¼Œè¶Šå¤§è¶Šé å‰ |
| `url` | string | å¦ | - | å¯é€‰çš„ç‚¹å‡»è·³è½¬é“¾æ¥ |

#### Provider çº§åˆ«å¾½æ ‡æ³¨å…¥ (`badge_providers`)

ä¸ºåŒä¸€æœåŠ¡å•†çš„æ‰€æœ‰ç›‘æµ‹é¡¹è‡ªåŠ¨æ³¨å…¥æŒ‡å®šå¾½æ ‡ï¼š

```yaml
badge_providers:
  - provider: "88code"
    badges:
      - "api_key_official"   # ç®€å†™å½¢å¼ï¼šç›´æ¥å¼•ç”¨å¾½æ ‡ id
  - provider: "duckcoding"
    badges:
      - id: "api_key_user"   # å¯¹è±¡å½¢å¼ï¼šå¯è¦†ç›– tooltip
        tooltip_override: "ç”¨æˆ· @example æä¾›çš„ API Key"
```

**æ”¯æŒçš„å¼•ç”¨æ ¼å¼**ï¼š

1. **ç®€å†™å½¢å¼**ï¼šç›´æ¥å†™å¾½æ ‡ id å­—ç¬¦ä¸²
   ```yaml
   badges:
     - "api_key_official"
   ```

2. **å¯¹è±¡å½¢å¼**ï¼šå¯è¦†ç›– tooltip æ–‡æœ¬
   ```yaml
   badges:
     - id: "api_key_user"
       tooltip_override: "è‡ªå®šä¹‰æç¤ºæ–‡æœ¬"
   ```

#### Monitor çº§åˆ«å¾½æ ‡ (`badges`)

åœ¨å•ä¸ªç›‘æµ‹é¡¹ä¸­é…ç½®å¾½æ ‡ï¼Œä¼šä¸ `badge_providers` ä¸­çš„ provider çº§åˆ«å¾½æ ‡åˆå¹¶ï¼š

```yaml
monitors:
  - provider: "duckcoding"
    service: "cc"
    # ... å…¶ä»–é…ç½®
    badges:
      - "stream_support"         # ç®€å†™å½¢å¼
      - id: "api_key_user"       # å¯¹è±¡å½¢å¼
        tooltip_override: "ç‰¹å®šé€šé“çš„ API Key è¯´æ˜"
```

#### å¾½æ ‡åˆå¹¶è§„åˆ™

1. **æ¥æºåˆå¹¶**ï¼šProvider çº§åˆ« + Monitor çº§åˆ«å¾½æ ‡è‡ªåŠ¨åˆå¹¶
2. **å»é‡**ï¼šç›¸åŒ `id` çš„å¾½æ ‡åªä¿ç•™ä¸€ä¸ªï¼ˆMonitor çº§åˆ«ä¼˜å…ˆï¼‰
3. **æ’åº**ï¼šæŒ‰ `weight` é™åºæ’åˆ—ï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰
4. **è¦†ç›–**ï¼šMonitor çº§åˆ«çš„ `tooltip_override` ä¼˜å…ˆäº Provider çº§åˆ«

#### å‰ç«¯æ˜¾ç¤º

- å¾½æ ‡æ˜¾ç¤ºåœ¨ç›‘æµ‹é¡¹çš„"å¾½æ ‡"åˆ—
- Label å’Œ Tooltip é€šè¿‡ i18n ç¿»è¯‘ï¼ˆé”®åï¼š`badges.generic.<id>.label`ã€`badges.generic.<id>.tooltip`ï¼‰
- å¦‚æœé…ç½®äº† `tooltip_override`ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨è¦†ç›–æ–‡æœ¬
- ç›‘æµ‹é¢‘ç‡æŒ‡ç¤ºå™¨ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨å¾½æ ‡åŒºåŸŸï¼ˆæ ¹æ®ç›‘æµ‹é¡¹çš„ `interval` é…ç½®ï¼‰

#### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# 1. å®šä¹‰å…¨å±€å¾½æ ‡
badge_definitions:
  api_key_user:
    kind: "source"
    variant: "info"      # è“è‰²ï¼Œè¡¨ç¤ºç¤¾åŒºè´¡çŒ®
    weight: 50
  api_key_official:
    kind: "source"
    variant: "success"   # ç»¿è‰²ï¼Œè¡¨ç¤ºå®˜æ–¹ API
    weight: 80
  stream_support:
    kind: "feature"
    variant: "success"
    weight: 60

# 2. Provider çº§åˆ«æ³¨å…¥
badge_providers:
  - provider: "88code"
    badges:
      - "api_key_official"
  - provider: "community-relay"
    badges:
      - id: "api_key_user"
        tooltip_override: "ç¤¾åŒºç”¨æˆ·æä¾›çš„ API Keyï¼Œæ¬¢è¿ç”³è¯·æ”¶å½•"

# 3. Monitor çº§åˆ«é…ç½®
monitors:
  - provider: "88code"
    service: "cc"
    # è‡ªåŠ¨ç»§æ‰¿ api_key_official å¾½æ ‡
    # ...

  - provider: "88code"
    service: "cx"
    badges:
      - "stream_support"  # é¢å¤–æ·»åŠ æµå¼æ”¯æŒå¾½æ ‡
    # ...
```

### ä¸´æ—¶ä¸‹æ¶é…ç½®

ç”¨äºä¸´æ—¶ä¸‹æ¶æœåŠ¡å•†ï¼ˆå¦‚å•†å®¶ä¸é…åˆæ•´æ”¹ï¼‰ï¼Œæ”¯æŒä¸¤ç§çº§åˆ«ï¼š

#### Provider çº§åˆ«ä¸‹æ¶

æ‰¹é‡ä¸‹æ¶æ•´ä¸ªæœåŠ¡å•†çš„æ‰€æœ‰ç›‘æµ‹é¡¹ï¼š

```yaml
hidden_providers:
  - provider: "é—®é¢˜å•†å®¶A"
    reason: "æœåŠ¡è´¨é‡ä¸è¾¾æ ‡ï¼Œå¾…æ•´æ”¹"
  - provider: "é—®é¢˜å•†å®¶B"
    reason: "API é¢‘ç¹è¶…æ—¶ï¼Œæ²Ÿé€šæ•´æ”¹ä¸­"

monitors:
  - provider: "é—®é¢˜å•†å®¶A"  # è‡ªåŠ¨ç»§æ‰¿ hidden=true
    service: "cc"
    # ...
```

#### Monitor çº§åˆ«ä¸‹æ¶

ä¸‹æ¶å•ä¸ªç›‘æµ‹é¡¹ï¼š

```yaml
monitors:
  - provider: "æ­£å¸¸å•†å®¶"
    service: "cc"
    hidden: true                    # ä¸´æ—¶ä¸‹æ¶
    hidden_reason: "è¯¥é€šé“ä¸´æ—¶ç»´æŠ¤"  # ä¸‹æ¶åŸå› 
    # ...
```

#### ä¼˜å…ˆçº§è§„åˆ™

| Provider Hidden | Monitor Hidden | æœ€ç»ˆçŠ¶æ€ | åŸå› æ¥æº |
|-----------------|----------------|----------|----------|
| âœ… | âŒ | **éšè—** | provider.reason |
| âŒ | âœ… | **éšè—** | monitor.hidden_reason |
| âœ… | âœ… | **éšè—** | monitor.hidden_reasonï¼ˆä¼˜å…ˆï¼‰ |
| âŒ | âŒ | **æ˜¾ç¤º** | - |

#### è°ƒè¯•æ¥å£

```bash
# æŸ¥çœ‹åŒ…å«éšè—é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼ˆå†…éƒ¨è°ƒè¯•ç”¨ï¼‰
curl "http://localhost:8080/api/status?include_hidden=true"
```

### å½»åº•åœç”¨é…ç½®

ç”¨äºå½»åº•åœç”¨æœåŠ¡å•†ï¼ˆå¦‚å•†å®¶å·²è·‘è·¯ã€æ°¸ä¹…å…³é—­ï¼‰ï¼Œä¸"ä¸´æ—¶ä¸‹æ¶"çš„åŒºåˆ«æ˜¯**ä¸ä¼šç»§ç»­æ¢æµ‹å’Œå­˜å‚¨æ•°æ®**ã€‚

#### Provider çº§åˆ«åœç”¨

æ‰¹é‡åœç”¨æ•´ä¸ªæœåŠ¡å•†çš„æ‰€æœ‰ç›‘æµ‹é¡¹ï¼š

```yaml
disabled_providers:
  - provider: "å·²è·‘è·¯å•†å®¶A"
    reason: "å•†å®¶å·²è·‘è·¯ï¼Œä¸å†ç›‘æµ‹"
  - provider: "å·²å…³ç«™å•†å®¶B"
    reason: "æœåŠ¡æ°¸ä¹…å…³é—­"

monitors:
  - provider: "å·²è·‘è·¯å•†å®¶A"  # è‡ªåŠ¨ç»§æ‰¿ disabled=true
    service: "cc"
    # ...
```

#### Monitor çº§åˆ«åœç”¨

åœç”¨å•ä¸ªç›‘æµ‹é¡¹ï¼š

```yaml
monitors:
  - provider: "æ­£å¸¸å•†å®¶"
    service: "legacy-channel"
    disabled: true                    # å½»åº•åœç”¨
    disabled_reason: "è¯¥é€šé“å·²åºŸå¼ƒ"   # åœç”¨åŸå› 
    # ...
```

#### ä¼˜å…ˆçº§è§„åˆ™

| Provider Disabled | Monitor Disabled | æœ€ç»ˆçŠ¶æ€ | åŸå› æ¥æº |
|-------------------|------------------|----------|----------|
| âœ… | âŒ | **åœç”¨** | provider.reason |
| âŒ | âœ… | **åœç”¨** | monitor.disabled_reason |
| âœ… | âœ… | **åœç”¨** | monitor.disabled_reasonï¼ˆä¼˜å…ˆï¼‰ |
| âŒ | âŒ | ç»§ç»­æ£€æŸ¥ hidden | - |

#### Disabled vs Hidden å¯¹æ¯”

| ç‰¹æ€§ | `disabled=true` | `hidden=true` |
|------|-----------------|---------------|
| è°ƒåº¦å™¨æ¢æµ‹ | âŒ ä¸æ¢æµ‹ | âœ… ç»§ç»­æ¢æµ‹ |
| æ•°æ®å­˜å‚¨ | âŒ ä¸å­˜å‚¨ | âœ… ç»§ç»­å­˜å‚¨ |
| API è¿”å› | âŒ æ°¸ä¸è¿”å› | âŒ é»˜è®¤ä¸è¿”å›ï¼Œå¯ç”¨ `include_hidden=true` æŸ¥çœ‹ |
| é€‚ç”¨åœºæ™¯ | å•†å®¶è·‘è·¯ã€æœåŠ¡æ°¸ä¹…å…³é—­ | ä¸´æ—¶æ•´æ”¹ã€å¾…è§‚å¯Ÿ |

## ç¯å¢ƒå˜é‡è¦†ç›–

ä¸ºäº†å®‰å…¨æ€§ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥ç®¡ç† API Keyï¼Œè€Œä¸æ˜¯å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚

### API Key ç¯å¢ƒå˜é‡

**å‘½åè§„åˆ™**ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š

1. **è‡ªå®šä¹‰ç¯å¢ƒå˜é‡å**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼š
   ```
   é…ç½®ä¸­æŒ‡å®šçš„ env_var_name å­—æ®µå€¼
   ```

2. **æ ‡å‡†æ ¼å¼ï¼ˆå« channelï¼‰**ï¼š
   ```
   MONITOR_<PROVIDER>_<SERVICE>_<CHANNEL>_API_KEY
   ```

3. **æ ‡å‡†æ ¼å¼ï¼ˆä¸å« channelï¼‰**ï¼ˆå‘åå…¼å®¹ï¼‰ï¼š
   ```
   MONITOR_<PROVIDER>_<SERVICE>_API_KEY
   ```

**å‘½åè½¬æ¢è§„åˆ™**:
- æ‰€æœ‰å­—æ¯è½¬ä¸º**å¤§å†™**
- ç‰¹æ®Šå­—ç¬¦ï¼ˆ`-`ã€ç©ºæ ¼ã€ä¸­æ–‡ç­‰ï¼‰æ›¿æ¢ä¸º `_`
- è¿ç»­çš„ `_` åˆå¹¶ä¸ºä¸€ä¸ª
- å»é™¤é¦–å°¾ä¸‹åˆ’çº¿

**ç¤ºä¾‹**:

| é…ç½® | ç¯å¢ƒå˜é‡åï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ | è¯´æ˜ |
|------|----------------------|------|
| `provider: "88code"`, `service: "cc"` | `MONITOR_88CODE_CC_API_KEY` | æ—  channelï¼Œä½¿ç”¨æ ‡å‡†æ ¼å¼ |
| `provider: "88code"`, `service: "cc"`, `channel: "vip3"` | `MONITOR_88CODE_CC_VIP3_API_KEY` | æœ‰ channelï¼Œä¼˜å…ˆåŒ¹é…å¸¦ channel æ ¼å¼ |
| `provider: "duckcoding"`, `service: "cx"`, `channel: "cxä¸“ç”¨"` | `MONITOR_DUCKCODING_CX_CXä¸“ç”¨_API_KEY` | ä¸­æ–‡ channelï¼Œå»ºè®®ä½¿ç”¨ `env_var_name` |
| `provider: "duckcoding"`, `service: "cx"`, `channel: "cxä¸“ç”¨"`, `env_var_name: "MONITOR_DUCKCODING_CX_CX_DEDICATED_API_KEY"` | `MONITOR_DUCKCODING_CX_CX_DEDICATED_API_KEY` | è‡ªå®šä¹‰ç¯å¢ƒå˜é‡åï¼Œä¼˜å…ˆçº§æœ€é«˜ |

**ä½¿ç”¨æ–¹å¼**:

```bash
# æ–¹å¼1ï¼šç›´æ¥å¯¼å‡º
export MONITOR_88CODE_CC_VIP3_API_KEY="sk-your-real-key"
./monitor

# æ–¹å¼2ï¼šä½¿ç”¨ .env æ–‡ä»¶ï¼ˆæ¨èï¼‰
cat > .env <<EOF
MONITOR_88CODE_CC_VIP3_API_KEY=sk-xxx
MONITOR_DUCKCODING_CX_CX_DEDICATED_API_KEY=sk-yyy
EOF

# Docker Compose è‡ªåŠ¨åŠ è½½ .env æ–‡ä»¶
docker compose up -d

# æˆ–æ‰‹åŠ¨æŒ‡å®š
docker compose --env-file .env up -d
```

**æœ€ä½³å®è·µ**:
- âœ… ä½¿ç”¨ `.env` æ–‡ä»¶é›†ä¸­ç®¡ç†ï¼ˆå·²åœ¨ `.gitignore`ï¼Œä¸ä¼šæäº¤ï¼‰
- âœ… ä¸­æ–‡ channel ä½¿ç”¨ `env_var_name` æŒ‡å®šè¯­ä¹‰åŒ–è‹±æ–‡åç§°
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Secret ç®¡ç†å·¥å…·ï¼ˆVaultã€K8s Secretsï¼‰
- âŒ é¿å…åœ¨é…ç½®æ–‡ä»¶ä¸­ç¡¬ç¼–ç  `api_key` å­—æ®µ

### API Key è´£ä»»è¯´æ˜

> **é‡è¦**ï¼šä½¿ç”¨ API Key è¿›è¡Œç›‘æµ‹æ—¶ï¼Œè¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹è´£ä»»è¯´æ˜ã€‚

#### Key çš„æä¾›ä¸ç®¡ç†è´£ä»»

ä½¿ç”¨è€…è‡ªè¡Œæä¾›å¹¶ç®¡ç†ç”¨äºç¬¬ä¸‰æ–¹æœåŠ¡çš„ API Key/Tokenã€‚ä½¿ç”¨è€…åº”ç¡®ä¿ï¼š

- âœ… Key çš„è·å–ä¸ä½¿ç”¨ç¬¦åˆç¬¬ä¸‰æ–¹æœåŠ¡çš„æ¡æ¬¾ã€æ”¿ç­–ä¸é€‚ç”¨æ³•å¾‹
- âœ… Key ä¸è¢«æ³„éœ²ã€ä¸è¢«å†™å…¥å…¬å¼€ä»“åº“/æ—¥å¿—/æˆªå›¾
- âœ… åŠæ—¶è½®æ¢ä¸æ’¤é”€ç–‘ä¼¼æ³„éœ²çš„ Key
- âœ… ç›‘æµ‹å¯¹åº” Key çš„å¼‚å¸¸ä½¿ç”¨æƒ…å†µï¼ˆå¦‚æµé‡å¼‚å¸¸ã€è´¹ç”¨å¼‚å¸¸ï¼‰

**RelayPulse ä¸æä¾›ä»»ä½•ç¬¬ä¸‰æ–¹ Key**ï¼Œä¹Ÿä¸å¯¹ä½¿ç”¨è€… Key çš„åˆæ³•æ€§ã€æˆæƒèŒƒå›´ã€é…é¢/è´¹ç”¨ã€å°ç¦é£é™©æ‰¿æ‹…è´£ä»»ã€‚

#### è´¹ç”¨ä¸é…é¢

è‹¥ç¬¬ä¸‰æ–¹æœåŠ¡å¯¹ API è°ƒç”¨è®¡è´¹æˆ–é™åˆ¶é…é¢ï¼Œç›¸å…³è´¹ç”¨ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚RelayPulse ä»…æŒ‰é…ç½®å‘èµ·æŠ€æœ¯è¯·æ±‚ï¼Œä¸å¯¹ç¬¬ä¸‰æ–¹è®¡è´¹ç­–ç•¥æˆ–ç»“ç®—ç»“æœè´Ÿè´£ã€‚

#### è¯¯ç”¨ä¸åˆè§„

ä½¿ç”¨è€…ä¸å¾—åˆ©ç”¨ RelayPulse æˆ–å…¶é›†æˆæ¥å£ä»äº‹è¿åç¬¬ä¸‰æ–¹æ¡æ¬¾æˆ–é€‚ç”¨æ³•å¾‹çš„è¡Œä¸ºã€‚å¯¹äºå› ä½¿ç”¨è€…é…ç½®æˆ–ä½¿ç”¨æ–¹å¼å¯¼è‡´çš„ Key å°ç¦ã€æœåŠ¡ä¸­æ–­ã€ç´¢èµ”æˆ–äº‰è®®ï¼ŒRelayPulse ä¸æ‰¿æ‹…è´£ä»»ã€‚

### å­˜å‚¨é…ç½®ç¯å¢ƒå˜é‡

#### SQLite

```bash
MONITOR_STORAGE_TYPE=sqlite
MONITOR_SQLITE_PATH=/data/monitor.db
```

#### PostgreSQL

```bash
MONITOR_STORAGE_TYPE=postgres
MONITOR_POSTGRES_HOST=postgres-service
MONITOR_POSTGRES_PORT=5432
MONITOR_POSTGRES_USER=monitor
MONITOR_POSTGRES_PASSWORD=your_secure_password
MONITOR_POSTGRES_DATABASE=llm_monitor
MONITOR_POSTGRES_SSLMODE=require
```

### CORS é…ç½®

```bash
# å…è®¸é¢å¤–çš„è·¨åŸŸæ¥æºï¼ˆé€—å·åˆ†éš”ï¼‰
MONITOR_CORS_ORIGINS=http://localhost:5173,http://localhost:3000
```

### Events API é…ç½®

Events API ç”¨äºå‘å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚ Notifierï¼‰æä¾›çŠ¶æ€å˜æ›´äº‹ä»¶æµã€‚

```bash
# Events API è®¿é—®ä»¤ç‰Œï¼ˆå¿…éœ€ï¼Œå¯ç”¨ /api/events ç«¯ç‚¹é‰´æƒï¼‰
# å¤–éƒ¨æœåŠ¡éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Authorization: Bearer <token>
EVENTS_API_TOKEN=your-secure-token-here
```

**å®‰å…¨å»ºè®®**ï¼š
- ç”Ÿæˆé«˜ç†µéšæœº tokenï¼š`openssl rand -hex 32`
- ä»…é€šè¿‡ HTTPS ä¼ è¾“
- å®šæœŸè½®æ¢ token

### å‰ç«¯ç¯å¢ƒå˜é‡

å‰ç«¯æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆéœ€åœ¨æ„å»ºæ—¶è®¾ç½®ï¼‰ï¼š

#### API é…ç½®

```bash
# API åŸºç¡€ URLï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºç›¸å¯¹è·¯å¾„ï¼‰
VITE_API_BASE_URL=http://localhost:8080

# æ˜¯å¦ä½¿ç”¨ Mock æ•°æ®ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
VITE_USE_MOCK_DATA=false
```

#### Notifier é…ç½®ï¼ˆè®¢é˜…é€šçŸ¥åŠŸèƒ½ï¼‰

```bash
# Notifier æœåŠ¡ URLï¼ˆå¯é€‰ï¼Œä¸è®¾ç½®åˆ™éšè—è®¢é˜…æŒ‰é’®ï¼‰
# ç”¨äºå¯ç”¨ Telegram è®¢é˜…é€šçŸ¥åŠŸèƒ½
VITE_NOTIFIER_API_URL=https://notifier.example.com
```

**è¯´æ˜**ï¼š
- æ­¤å˜é‡ä¸º**æ„å»ºæ—¶å˜é‡**ï¼Œéœ€åœ¨ `npm run build` å‰è®¾ç½®
- å¦‚æœæœªè®¾ç½®æˆ–ä¸ºç©ºï¼Œè®¢é˜…æŒ‰é’®å°†è‡ªåŠ¨éšè—
- Notifier æ˜¯ç‹¬ç«‹çš„é€šçŸ¥æœåŠ¡ï¼Œè¯¦è§ `notifier/README.md`

#### Google Analyticsï¼ˆå¯é€‰ï¼‰

```bash
# GA4 Measurement IDï¼ˆæ ¼å¼: G-XXXXXXXXXXï¼‰
VITE_GA_MEASUREMENT_ID=G-XXXXXXXXXX
```

**è·å– GA4 Measurement ID**ï¼š
1. è®¿é—® [Google Analytics](https://analytics.google.com/)
2. åˆ›å»ºæˆ–é€‰æ‹©å±æ€§
3. åœ¨"ç®¡ç†" > "æ•°æ®æµ" > "ç½‘ç«™"ä¸­æŸ¥çœ‹ Measurement ID

**ä½¿ç”¨æ–¹å¼**ï¼š

```bash
# å¼€å‘ç¯å¢ƒï¼šåœ¨ frontend/.env.development ä¸­è®¾ç½®
VITE_GA_MEASUREMENT_ID=

# ç”Ÿäº§ç¯å¢ƒï¼šåœ¨ frontend/.env.production ä¸­è®¾ç½®
VITE_GA_MEASUREMENT_ID=G-XXXXXXXXXX

# æˆ–åœ¨æ„å»ºæ—¶é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥
export VITE_GA_MEASUREMENT_ID=G-XXXXXXXXXX
cd frontend && npm run build
```

**è¿½è¸ªäº‹ä»¶**ï¼š

GA4 ä¼šè‡ªåŠ¨è¿½è¸ªä»¥ä¸‹äº‹ä»¶ï¼š
- **é¡µé¢æµè§ˆ**ï¼ˆè‡ªåŠ¨ï¼‰ - ç”¨æˆ·è®¿é—®ä»ªè¡¨æ¿
- **ç”¨æˆ·ç­›é€‰**ï¼š
  - `change_time_range` - åˆ‡æ¢æ—¶é—´èŒƒå›´ï¼ˆ24h/7d/30dï¼‰
  - `filter_service` - ç­›é€‰æœåŠ¡æä¾›å•†æˆ–æœåŠ¡ç±»å‹
  - `filter_channel` - ç­›é€‰ä¸šåŠ¡é€šé“
  - `filter_category` - ç­›é€‰åˆ†ç±»ï¼ˆcommercial/publicï¼‰
- **ç”¨æˆ·äº¤äº’**ï¼š
  - `change_view_mode` - åˆ‡æ¢è§†å›¾æ¨¡å¼ï¼ˆtable/gridï¼‰
  - `manual_refresh` - ç‚¹å‡»åˆ·æ–°æŒ‰é’®
  - `click_external_link` - ç‚¹å‡»å¤–éƒ¨é“¾æ¥ï¼ˆæŸ¥çœ‹æä¾›å•†/èµåŠ©å•†ï¼‰
- **æ€§èƒ½ç›‘æµ‹**ï¼š
  - `api_request` - API è¯·æ±‚æ€§èƒ½ï¼ˆåŒ…å«å»¶è¿Ÿã€æˆåŠŸ/å¤±è´¥çŠ¶æ€ï¼‰
  - `api_error` - API é”™è¯¯ï¼ˆåŒ…å«é”™è¯¯ç±»å‹ï¼šHTTP_XXXã€NETWORK_ERRORï¼‰

**æ³¨æ„**ï¼š
- å¼€å‘ç¯å¢ƒå»ºè®®ç•™ç©º `VITE_GA_MEASUREMENT_ID`ï¼Œé¿å…æ±¡æŸ“ç”Ÿäº§æ•°æ®
- å¦‚æœæœªè®¾ç½® Measurement IDï¼ŒGA4 è„šæœ¬ä¸ä¼šåŠ è½½

## é…ç½®éªŒè¯

æœåŠ¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®ï¼š

### éªŒè¯è§„åˆ™

1. **å¿…å¡«å­—æ®µæ£€æŸ¥**: `provider`, `service`, `category`, `sponsor`, `url`, `method`
2. **HTTP æ–¹æ³•æ ¡éªŒ**: å¿…é¡»æ˜¯ `GET`, `POST`, `PUT`, `DELETE`, `PATCH` ä¹‹ä¸€
3. **å”¯ä¸€æ€§æ£€æŸ¥**: `provider + service + channel` ç»„åˆå¿…é¡»å”¯ä¸€
4. **`category` æšä¸¾**: å¿…é¡»æ˜¯ `commercial` æˆ– `public`
5. **å­˜å‚¨ç±»å‹æ ¡éªŒ**: å¿…é¡»æ˜¯ `sqlite` æˆ– `postgres`

### éªŒè¯å¤±è´¥ç¤ºä¾‹

```bash
# ç¼ºå°‘å¿…å¡«å­—æ®µ
âŒ æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶: monitor[0]: ç¼ºå°‘å¿…å¡«å­—æ®µ 'category'

# é‡å¤çš„ provider + service + channel
âŒ æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶: é‡å¤çš„ç›‘æµ‹é¡¹: provider=88code, service=cc, channel=

# æ— æ•ˆçš„ HTTP æ–¹æ³•
âŒ æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶: monitor[0]: æ— æ•ˆçš„ method 'INVALID'
```

## é…ç½®çƒ­æ›´æ–°

Relay Pulse æ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼Œä¿®æ”¹é…ç½®åæ— éœ€é‡å¯æœåŠ¡ã€‚

### å·¥ä½œåŸç†

1. ä½¿ç”¨ `fsnotify` ç›‘å¬é…ç½®æ–‡ä»¶å˜æ›´
2. æ£€æµ‹åˆ°å˜æ›´åï¼Œå…ˆéªŒè¯æ–°é…ç½®
3. å¦‚æœéªŒè¯é€šè¿‡ï¼ŒåŸå­æ€§åœ°æ›´æ–°è¿è¡Œæ—¶é…ç½®
4. å¦‚æœéªŒè¯å¤±è´¥ï¼Œä¿æŒæ—§é…ç½®å¹¶è¾“å‡ºé”™è¯¯æ—¥å¿—

### ä½¿ç”¨ç¤ºä¾‹

```bash
# å¯åŠ¨æœåŠ¡
docker compose up -d

# ä¿®æ”¹é…ç½®ï¼ˆæ·»åŠ æ–°çš„ç›‘æµ‹é¡¹ï¼‰
vi config.yaml

# è§‚å¯Ÿæ—¥å¿—
docker compose logs -f monitor

# åº”è¯¥çœ‹åˆ°:
# [Config] æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜æ›´ï¼Œæ­£åœ¨é‡è½½...
# [Config] çƒ­æ›´æ–°æˆåŠŸï¼å·²åŠ è½½ 3 ä¸ªç›‘æµ‹ä»»åŠ¡
# [Scheduler] é…ç½®å·²æ›´æ–°ï¼Œä¸‹æ¬¡å·¡æ£€å°†ä½¿ç”¨æ–°é…ç½®
# [Scheduler] ç«‹å³è§¦å‘å·¡æ£€
```

### æ³¨æ„äº‹é¡¹

- **å­˜å‚¨é…ç½®ä¸æ”¯æŒçƒ­æ›´æ–°**: ä¿®æ”¹ `storage` é…ç½®éœ€è¦é‡å¯æœåŠ¡
- **ç¯å¢ƒå˜é‡ä¸çƒ­æ›´æ–°**: ç¯å¢ƒå˜é‡è¦†ç›–çš„ API Key ä¸ä¼šçƒ­æ›´æ–°
- **è¯­æ³•é”™è¯¯**: å¦‚æœæ–°é…ç½®æœ‰è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡ä¼šä¿æŒæ—§é…ç½®å¹¶è¾“å‡ºé”™è¯¯

## é…ç½®æœ€ä½³å®è·µ

### 1. API Key ç®¡ç†

âŒ **ä¸æ¨è**ï¼ˆä¸å®‰å…¨ï¼‰:

```yaml
monitors:
  - provider: "openai"
    api_key: "sk-proj-real-key-here"  # ä¸è¦å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼
```

âœ… **æ¨è**ï¼ˆå®‰å…¨ï¼‰:

```yaml
monitors:
  - provider: "openai"
    # api_key ç•™ç©ºï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡
```

```bash
# .env æ–‡ä»¶ï¼ˆæ·»åŠ åˆ° .gitignoreï¼‰
MONITOR_OPENAI_GPT4_API_KEY=sk-proj-real-key-here
```

### 2. å¤§å‹è¯·æ±‚ä½“

âŒ **ä¸æ¨è**ï¼ˆé…ç½®æ–‡ä»¶è¿‡é•¿ï¼‰:

```yaml
body: |
  {
    "model": "gpt-4",
    "messages": [/* å¾ˆé•¿çš„æ¶ˆæ¯åˆ—è¡¨ */],
    "max_tokens": 1000,
    "temperature": 0.7,
    /* æ›´å¤šé…ç½®... */
  }
```

âœ… **æ¨è**ï¼ˆä½¿ç”¨ `!include`ï¼‰:

```yaml
body: "!include data/gpt4_request.json"
```

```json
// data/gpt4_request.json
{
  "model": "gpt-4",
  "messages": [/* å¾ˆé•¿çš„æ¶ˆæ¯åˆ—è¡¨ */],
  "max_tokens": 1000,
  "temperature": 0.7
}
```

### 3. ç¯å¢ƒéš”ç¦»

```bash
# å¼€å‘ç¯å¢ƒ
config.yaml                # æœ¬åœ°å¼€å‘é…ç½®
.env.local                 # æœ¬åœ° API Keysï¼ˆæ·»åŠ åˆ° .gitignoreï¼‰

# ç”Ÿäº§ç¯å¢ƒ
config.production.yaml     # ç”Ÿäº§é…ç½®ï¼ˆä¸å«æ•æ„Ÿä¿¡æ¯ï¼‰
deploy/relaypulse.env      # ç”Ÿäº§ API Keysï¼ˆæ·»åŠ åˆ° .gitignoreï¼‰
```

### 4. å®‰å…¨åŠ å›º

1. **æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡**
2. **ç”Ÿäº§ç¯å¢ƒå¯ç”¨ PostgreSQL SSL**: `sslmode: "require"`
3. **é™åˆ¶ CORS**: åªå…è®¸ä¿¡ä»»çš„åŸŸå
4. **å®šæœŸè½®æ¢ API Key**
5. **ä½¿ç”¨æœ€å°æƒé™åŸåˆ™**: æ•°æ®åº“ç”¨æˆ·åªæˆäºˆå¿…è¦æƒé™

## é…ç½®ç¤ºä¾‹åº“

### ç¤ºä¾‹1ï¼šOpenAI GPT-4

```yaml
monitors:
  - provider: "openai"
    service: "gpt-4"
    category: "commercial"
    sponsor: "å›¢é˜Ÿ"
    url: "https://api.openai.com/v1/chat/completions"
    method: "POST"
    headers:
      Authorization: "Bearer {{API_KEY}}"
      Content-Type: "application/json"
    body: |
      {
        "model": "gpt-4",
        "messages": [{"role": "user", "content": "hi"}],
        "max_tokens": 1
      }
    success_contains: "choices"
```

### ç¤ºä¾‹2ï¼šAnthropic Claude

```yaml
monitors:
  - provider: "anthropic"
    service: "claude-3"
    category: "public"
    sponsor: "ç¤¾åŒº"
    url: "https://api.anthropic.com/v1/messages"
    method: "POST"
    headers:
      x-api-key: "{{API_KEY}}"
      anthropic-version: "2023-06-01"
      Content-Type: "application/json"
    body: |
      {
        "model": "claude-3-opus-20240229",
        "messages": [{"role": "user", "content": "hi"}],
        "max_tokens": 1
      }
    success_contains: "content"
```

### ç¤ºä¾‹3ï¼šè‡ªå®šä¹‰ REST API

```yaml
monitors:
  - provider: "custom-api"
    service: "health"
    category: "public"
    sponsor: "è‡ªæœ‰"
    url: "https://api.example.com/health"
    method: "GET"
    success_contains: "ok"
```

## æ•…éšœæ’æŸ¥

### é…ç½®ä¸ç”Ÿæ•ˆ

1. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹æ—¥å¿—ä¸­çš„éªŒè¯é”™è¯¯
3. ç¡®è®¤ç¯å¢ƒå˜é‡æ ¼å¼æ­£ç¡®

### çƒ­æ›´æ–°å¤±è´¥

1. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•ï¼ˆYAML æ ¼å¼ï¼‰
2. éªŒè¯å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. PostgreSQL: æ£€æŸ¥ `host`, `port`, `user`, `password` æ˜¯å¦æ­£ç¡®
2. SQLite: æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™
3. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—

## ä¸‹ä¸€æ­¥

- [è¿ç»´æ‰‹å†Œï¼ˆå†å²æ–‡æ¡£ï¼Œä»…ä¾›å‚è€ƒï¼‰](../../archive/docs/user/operations.md) - æ—¥å¸¸è¿ç»´ä¸æ•…éšœæ’æŸ¥
- [API ç«¯ç‚¹ç¤ºä¾‹](../../README.md#-api-ç«¯ç‚¹) - å½“å‰æƒå¨å‚è€ƒï¼ˆæ­£å¼ API è§„èŒƒæ•´ç†ä¸­ï¼‰
